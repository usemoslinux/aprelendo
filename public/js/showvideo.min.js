$(document).ready((function(){let e,t,n,o,a,r=!1,i=!1,s=null,d="",l="",c="",u=!1,h=!1,p=!0,w=0,g=$("html").attr("lang"),f=.01*window.innerHeight;document.documentElement.style.setProperty("--vh",`${f}px`),$.ajax({url:"ajax/getdicuris.php",type:"GET",dataType:"json"}).done((function(e){null==e.error_msg&&(d=e.dictionary_uri,l=e.translator_uri)})),$.ajax({type:"POST",url:"/ajax/getuserwords.php",data:{txt:$("#text-container").html()},dataType:"json"}).done((function(e){$("#text-container").html(underlineWords(e,g,!1))})).fail((function(e,t,n){})),$(document).on("contextmenu",".word",(function(e){return e.preventDefault(),!1})),$(document).on("mousedown touchstart",".word",(function(o){o.stopPropagation(),h=1!=player.getPlayerState(),h||(player.pauseVideo(),u=!0),o.which<2?(r=!0,e=t=$(this),"touchstart"==o.type&&(n=new Date,a=e.offset().top-$(window).scrollTop())):3==o.which&&(s=$(this),window.open(buildTranslationLink(l,s)))})),$(document).on("mouseup touchend",".word",(function(a){a.stopPropagation(),o=new Date,"touchend"==a.type&&(i||(r=o-n>1e3),$("html").css({overflow:"visible"}),i=!1),r&&a.which<2&&(r=!1,e===t&&(s=$(this)),function(){getWordFrequency(s.text(),g),setAddDeleteButtons(),$("#loading-spinner").attr("class","lds-ellipsis m-auto"),$("#dicFrame").attr("class","d-none"),c=buildTranslationLink(l,s);const e=s.text().replace(/(\r\n|\n|\r)/gm," "),t=d.replace("%s",encodeURIComponent(e));$(parent.document).find("#dicFrame").get(0).contentWindow.location.replace(t),$("#btnadd").focus(),$(parent.document).find("#dic-modal").modal("show")}())})),$.fn.isAfter=function(e){return this.prevUntil(e).length!==this.prevAll().length},$(document).on("mouseover touchmove",".word",(function(d){if(d.stopPropagation(),o=new Date,"touchmove"==d.type){const e=$(this).offset().top-$(window).scrollTop();i=i||Math.abs(a-e)>0,i||(r=o-n>1e3)}r&&("touchmove"==d.type&&$("html").css({overflow:"hidden"}),$(".word").removeClass("highlighted"),t="mouseover"===d.type?$(this):$(document.elementFromPoint(d.originalEvent.touches[0].clientX,d.originalEvent.touches[0].clientY)),e.parent().get(0)===t.parent().get(0)?t.isAfter(e)?(e.nextUntil(t.next(),".word").addBack().addClass("highlighted"),s=e.nextUntil(t.next()).addBack()):(e.prevUntil(t.prev(),".word").addBack().addClass("highlighted"),s=t.nextUntil(e.next()).addBack()):t=s=e)})),$("#btnadd").on("click",(function(){const e=s.text(),t=s.length>1?1:0;$.ajax({type:"POST",url:"ajax/addword.php",data:{word:e.toLowerCase(),is_phrase:t}}).done((function(){if(t){const t=s.eq(0).text(),n=s.filter(".word").length;$("a.word").filter((function(){return $(this).text().toLowerCase()===t.toLowerCase()})).each((function(){let t=$(this).nextAll("a.word").slice(0,n-1).last(),o=$(this).nextUntil(t).addBack().next("a.word").addBack();o.text().toLowerCase()===e.toLowerCase()&&(o.wrapAll("<a class='word reviewing new' data-toggle='modal' data-bs-target='#dic-modal'></a>"),o.contents().unwrap())}))}else{let t=$("a.word").filter((function(){return $(this).text().toLowerCase()===e.toLowerCase()}));t.each((function(){let e=$(this);e.is(".new, .learning, .learned, .forgotten")?e.wrap("<a class='word reviewing forgotten' data-toggle='modal' data-bs-target='#dic-modal'></a>"):e.wrap("<a class='word reviewing new' data-toggle='modal' data-bs-target='#dic-modal'></a>")})),t.contents().unwrap()}})).fail((function(e,t,n){alert("Oops! There was an error adding this word or phrase to the database.")}))})),$(window).on("resize",(function(){f=.01*window.innerHeight,document.documentElement.style.setProperty("--vh",`${f}px`)})),$("#btnremove").on("click",(function(){$.ajax({type:"POST",url:"ajax/removeword.php",data:{word:s.text().toLowerCase()}}).done((function(){let e=$("a.word").filter((function(){return $(this).text().toLowerCase()===s.text().toLowerCase()}));$.ajax({type:"POST",url:"/ajax/getuserwords.php",data:{txt:s.text()},dataType:"json"}).done((function(t){let n=$(underlineWords(t,g,!1)),o={},a=/""/;e.each((function(){o=$(this),n.filter(".word").each((function(e){a=langs_with_no_word_separator.includes(g)?new RegExp("(?<![^])"+$(this).text()+"(?![$])","iug").exec(o.text()):new RegExp("(?<![\\p{L}|^])"+$(this).text()+"(?![\\p{L}|$])","iug").exec(o.text()),$(this).text(a);const n=$(this).text().toLowerCase(),r=t.user_words.find((function(e){return e.word==n}));void 0!==r&&(2==r.status?$(this).removeClass("learning").addClass("new"):3==r.status&&$(this).removeClass("learning").addClass("forgotten"))})),o.replaceWith(n.clone())}))})).fail((function(e,t,n){}))})).fail((function(e,t,n){alert("Oops! There was an error removing the word from the database.")}))})),$(document).on("click","#btn-save-ytvideo",(function(){let e=[],t=[],n="";$(".learning").each((function(){n=$(this).text().toLowerCase(),-1==$.inArray(n,e)&&e.push(n)})),t.push($("#text-container").attr("data-textID")),$.ajax({type:"POST",url:"ajax/archivetext.php",data:{words:e,textIDs:JSON.stringify(t)}}).done((function(e){if(null==e.error_msg){const e={words:{new:$(".reviewing.new").length,learning:$(".reviewing.learning").length,forgotten:$(".reviewing.forgotten").length},texts:{reviewed:1}};$.ajax({type:"post",url:"ajax/updateuserscore.php",data:e}).done((function(e){if(null==e.error_msg){w=e.gems_earned,p=!1;const t="/textstats",n=Number($(".word").length)+Number($(".phrase").length),o=$('<form action="'+t+'" method="post"><input type="hidden" name="created" value="'+$(".reviewing.new").length+'" /><input type="hidden" name="reviewed" value="'+$(".reviewing.learning").length+'" /><input type="hidden" name="learned" value="'+$(".learned").length+'" /><input type="hidden" name="forgotten" value="'+$(".reviewing.forgotten").length+'" /><input type="hidden" name="total" value="'+n+'" /><input type="hidden" name="gems_earned" value="'+w+'" /><input type="hidden" name="is_shared" value="1" /></form>');$("body").append(o),o.submit()}else alert("Oops! There was an unexpected error.")})).fail((function(e,t,n){alert("Oops! There was an unexpected error.")}))}else alert("Oops! There was an unexpected error.")})).fail((function(e,t,n){alert("Oops! There was an error updating the database.")}))})),$("#dic-modal").on("hidden.bs.modal",(function(){u&&(player.playVideo(),u=!1),s.removeClass("highlighted")})),$("#dicFrame").on("load",(function(){$("#loading-spinner").attr("class","d-none"),$(this).removeClass()})),$("#btn-translate").on("click",(function(){window.open(c,"_blank","noopener")})),$("#text-container").on("click",(function(e){e.preventDefault(),e.stopPropagation(),r=!1,$("#text-container").find(".highlighted").removeClass("highlighted")})),$(window).on("beforeunload",(function(){if(p)return"To save your progress, please click the Save button before you go. Otherwise, your changes will be lost. Are you sure you want to exit this page?"}))}));