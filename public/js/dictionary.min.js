function buildTextTranslationLink(n,t){let e=t.prevUntil(":contains('.'), :contains('!'), :contains('?'), :contains('\n')").last();e=e.length>0?e:t;let r=0==t.prev().length?t.nextUntil(":contains('.'), :contains('。'), :contains('!'), :contains('?'), :contains('\n')").last().next():t.prev().nextUntil(":contains('.'), :contains('。'), :contains('!'), :contains('?'), :contains('\n')").last().next();r=r.length>0?r:t.nextAll().last().next();let a=r.text().length,i=e.nextUntil(r).addBack().next().addBack().text().replace(/(\r\n|\n|\r)/gm," ");return a>1&&i.slice(0,1-a),i.trim(),n.replace("%s",encodeURI(i))}function buildVideoTranslationLink(n,t){let e,r=t,a=$(),i="",l=!1;const d=":contains('.'), :contains('。'), :contains('!'), :contains('?')";for(;!l;){if(0===r.index()){i=r.text().replace(/(\r\n|\n|\r)/gm," ").trim();break}if(r.filter(d).length>0)break;e=r.prevAll(d).next().last(),l=e.length>0||r.filter(d).length>0,e=l?e:r.siblings().addBack().first(),a=e.nextUntil(r).addBack().next().addBack(),i=a.text().replace(/(\r\n|\n|\r)/gm," ").trim()+" "+i,r=r.parent().prev().children().last(),l=l||0===r.length}e=0===t.next().length?t:t.next();let o;for(l=i.match(/[.。!?]/g);!l;)r=e.nextAll(d).first(),r=r.index()===r.parent().children().length?e:r,l=r.length>0||e.filter(d).length>0,r=l?r:e.siblings().last(),e.filter(d).length>0?(a=e,o=""):(a=e.nextUntil(r).addBack().next().addBack(),o=" "),i=i.trim()+o+a.text().replace(/(\r\n|\n|\r)/gm," ").trim(),e=e.parent().next().children().first();return n.replace("%s",encodeURIComponent(i.trim()))}function buildStudyTranslationLink(n,t){const e=t.parent("p").text().trim();return n.replace("%s",encodeURIComponent(e))}function buildDictionaryLink(n,t){const e=t.trim().replace(/\r?\n|\r/gm," ");return n.replace("%s",encodeURIComponent(e))}function setAddDeleteButtons(n){let t=$("#btn-remove")||$(parent.document).find("#btn-remove"),e=$("#btn-add")||$(parent.document).find("#btn-add");const r=n.filter(".learning, .new, .forgotten, .learned").length;n.filter(".word").length==r?!1===t.is(":visible")&&(t.show(),e.text("Forgot").removeClass("btn-primary").addClass("btn-danger")):(t.hide(),e.text("Add").removeClass("btn-danger").addClass("btn-primary"))}function getWordFrequency(n,t){let e=$("#bdgfreqlvl")||$(parent.document).find("#bdgfreqlvl");$.ajax({type:"GET",url:"/ajax/getwordfreq.php",data:{word:n,lg_iso:t}}).done((function(n){0==n?e.hide():n<81?e.hide().text("High frequency word").removeClass().addClass("badge text-bg-danger").show():n<97&&e.hide().text("Medium frequency word").removeClass().addClass("badge text-bg-warning").show()})).fail((function(){e.hide()}))}