$(document).ready((function(){var e=$("script[src*='showebook-min.js']").attr("data-id"),t=ePub();(new FormData).append("id",e),fetch("ajax/getebook.php?id="+e).then((function(e){if(200===e.status)return e;throw new Error(e.statusText)})).then((e=>e.arrayBuffer())).then((e=>function(e){var n=e;t.open(n);var a=t.renderTo("viewer",{flow:"scrolled-doc"}),o=document.getElementById("readerpage");function r(){var e=$(document).find('iframe[id^="epubjs"]'),t=[],n="";e.contents().find(".learning").each((function(){n=$(this).text().toLowerCase(),-1==jQuery.inArray(n,t)&&t.push(n)})),$.ajax({type:"POST",url:"/ajax/archivetext.php",async:!1,data:{words:t}}).fail((function(e,t,n){alert("Oops! There was an error updating the database.")})),window.parent.show_confirmation_dialog=!1}a.themes.register("darkmode","/css/ebooks-min.css"),a.themes.register("lightmode","/css/ebooks-min.css"),a.themes.register("sepiamode","/css/ebooks-min.css"),a.themes.default({body:{"font-family":o.style.fontFamily+" !important","font-size":o.style.fontSize+" !important","text-align":o.style.textAlign+" !important","line-height":o.style.lineHeight+" !important",padding:"0 5% !important"}}),a.themes.select(o.className),t.ready.then((function(){var e=t.key()+"-lastpos",n=localStorage.getItem(e);if(n)a.display(n);else{var o=window.location.hash.slice(2);a.display(o||void 0)}a.hooks.content.register((function(e){e.addScript("https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js").then((function(){Promise.all([e.addScript("/js/underlinewords-min.js"),e.addScript("/js/showtext-min.js"),e.addScript("https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.6.0/js/bootstrap.min.js")]),$(".loading-spinner").fadeIn(1e3),$.ajax({type:"POST",url:"/ajax/getuserwords.php",data:{txt:$(e.content).html()},dataType:"json"}).done((function(t){e.content.innerHTML=underlineWords(t),$(".loading-spinner").fadeOut(1e3)})).fail((function(e,t,n){alert("There was an unexpected error when trying to underline words for this ebook!")}))}))})),document.getElementById("next").addEventListener("click",(function(e){e.preventDefault(),$.when(r()).then((function(){a.next(),$("html, body").animate({scrollTop:0},"slow")}))}),!1),document.getElementById("prev").addEventListener("click",(function(e){e.preventDefault(),$.when(r()).then((function(){a.prev(),$("html, body").animate({scrollTop:0},"slow")}))}),!1)})),a.on("rendered",(function(e){var n=e.next(),a=e.prev();n?(nextNav=t.navigation.get(n.href),nextNav?nextLabel=nextNav.label:nextLabel="next",next.textContent=nextLabel+" »"):next.textContent="",a?(prevNav=t.navigation.get(a.href),prevNav?prevLabel=prevNav.label:prevLabel="previous",prev.textContent="« "+prevLabel):prev.textContent=""})),$("body").on("click","#btn-save",(function(){var e=a.currentLocation().start.cfi;localStorage.setItem(t.key()+"-lastpos",e),r(),window.location.replace("texts.php")})),a.on("relocated",(function(e){})),parent.window.addEventListener("unload",(function(){t.destroy()}));var i=document.getElementById("navigation"),d=document.getElementById("main");document.getElementById("opener").addEventListener("click",(function(e){i.classList.toggle("sidebar-closed"),d.classList.toggle("sidebar-opened"),e.preventDefault()}),!1),t.loaded.navigation.then((function(e){var t=document.getElementById("toc"),n=document.createDocumentFragment(),o=function(e,t){var n=document.createElement("ul");t.forEach((function(e){var t=document.createElement("li"),r=document.createElement("a");r.textContent=e.label,r.href=e.href,t.appendChild(r),e.subitems&&o(t,e.subitems),r.onclick=function(){var e=r.getAttribute("href");return a.display(e),i.classList.add("closed"),!1},n.appendChild(t)})),e.appendChild(n)};o(n,e),t.appendChild(n),t.offsetHeight+60<window.innerHeight&&t.classList.add("fixed")})),t.loaded.metadata.then((function(e){var n=document.getElementById("title"),a=document.getElementById("book-title"),o=document.getElementById("author"),r=document.getElementById("cover");null!=n&&(n.textContent=e.title,a.textContent=e.title,o.textContent=e.creator,t.archive?t.archive.createUrl(t.cover).then((function(e){r.src=e})):r.src=t.cover)}))}(e))).catch((function(e){alert("There was an unexpected problem opening this ebook file. Try again later."),window.location.replace("texts.php")}))}));