$(document).ready((function(){function e(e,t){$("#alert-msg").html(e).removeClass().addClass("alert "+t),$(window).scrollTop(0)}function t(e){$("#upload-progress-bar").parent().addClass("d-none"),$("#btn-upload-epub").removeClass("disabled"),$("#btn-save").removeClass("disabled"),e&&($("#title").val(""),$("#author").val(""),$("#url").val(""))}function a(e){const t=ePub(),a=e.target.result;t.open(a),t.loaded.metadata.then((function(e){const t=document.getElementById("title"),a=document.getElementById("author");null!=t&&(t.value=e.title,a.value=e.creator)})),window.addEventListener("unload",(function(){t.destroy()}))}t(!0),$("#btn-upload-epub").on("click",(function(){$("#url").trigger("click")})),$("#url").on("change",(function(){$("#alert-msg").addClass("d-none");const n=$(this),o=n[0].files[0].name.split(".").pop().toLowerCase();if(n[0].files[0].size>2097152)e("This file is bigger than the allowed limit (2 MB). Please try again.","alert-danger"),t(!0);else if("epub"!=o)e("Invalid file extension. Only .epub files are allowed.","alert-danger"),t(!0);else if(window.FileReader){const e=new FileReader;e.onload=a,e.readAsArrayBuffer(n[0].files[0])}})),$("#form-addebook").on("submit",(function(a){a.preventDefault();const n=$("#upload-progress-bar"),o=new FormData(document.getElementById("form-addebook")),l=$("#audio-uri").text();$("#alert-msg").addClass("d-none"),""==l||function(e){let t;try{t=new URL(e)}catch(e){return!1}return"http:"===t.protocol||"https:"===t.protocol}(l)?(n.parent().removeClass("d-none"),$("#btn-upload-epub").addClass("disabled"),$("#btn-save").addClass("disabled"),n.width("33%"),n.text("Uploading epub file..."),$.ajax({type:"POST",url:"ajax/addtext.php",data:o,dataType:"json",contentType:!1,processData:!1}).done((function(a){null!=a.error_msg?(e(a.error_msg,"alert-danger"),t(!1)):(n.width("100%"),n.text("Upload complete..."),n.parent().delay(1500).fadeOut("slow",(function(){window.location.replace("/texts")})))})).fail((function(a,n,o){e("Oops! There was an unexpected error uploading this text.","alert-danger"),t(!1)}))):e("Invalid audio URL.","alert-danger")}))}));