$(document).ready((function(){let e="",a="";const t=$("#dicFrame");let n=$(),r=[],o=10,s=0,d=0,l=[["0",0,"bg-success","Excellent"],["1",0,"bg-info","Partial"],["2",0,"bg-warning","Fuzzy"],["3",0,"bg-danger","No recall"]];function c(e){(function(){if(0==o)return $("#card-header").text("Sorry, no cards to practice"),$("#card-text").html("<div class='bi bi-exclamation-circle text-danger display-3'></div><div class='mt-3'>It seems you don't have any cards left for learning.</div>"),$("#card-footer").addClass("d-none"),$("#card-loader").addClass("d-none"),!0;if(d>o-1){$("#card-header").text("Congratulations!");let e="";for(const a of l){let t=a[1],n=t/o*100;e+="<div class='progress-bar "+a[2]+"' role='progressbar' aria-valuenow='"+n+"' aria-valuemin='0' aria-valuemax='100' style='width: "+n+"%' title='"+a[3]+": "+t+" answer(s)'>"+n+" %</div>"}return $("#card-text").html("<div class='bi bi-trophy text-primary display-3 mt-3'></div><div class='mt-3'>You have reached the end of your study.</div><div class='mt-3'>These were your results:</div><div class='progress mx-auto mt-3 fw-bold' style='height: 25px;max-width: 550px'>"+e+"</div><div class='small mt-4'>If you want to continue, you can refresh this page (F5).<br>However, we strongly recommend that you keep your study sessions short and take rest intervals.</div>"),$("#card-footer").addClass("d-none"),$("#card-loader").addClass("d-none"),!0}return!1})()||($("#card-loader").removeClass("d-none"),$("#card-text").empty(),$("#card-header").html("Looking for examples of "+e+"..."),$.ajax({type:"POST",url:"ajax/getcards.php",data:{word:e},dataType:"json"}).done((function(a){let t="",n=0;const l=$("#card").data("lang");let u=new RegExp("([^\\n.?!]|[\\d][.][\\d]|[A-Z][.](?:[A-Z][.])+)*(?<![\\p{L}])"+e+"(?![\\p{L}])([^\\n.?!]|[.][\\d]|[.](?:[A-Z][.])+)*[\\n.?!]","gmiu");"ja"!=l&&"zh"!=l||(u=new RegExp("[^\n?!。]*"+e+"[^\n?!。]*[\n?!。]","gmiu"));const p=new RegExp("(?<![\\p{L}|\\d])"+e+"(?![\\p{L}|\\d])","gmiu"),h=new RegExp("^[\\s\\d]+|[\\s\\d]+$","g");if(a.forEach((a=>{let r;for(;null!==(r=u.exec(a.text));)if(r.index===u.lastIndex&&u.lastIndex++,n<3){let o=r[0];o=o.replace(h,""),o=i(o),o!==e&&(o=o.replace(p,(function(e,a){return void 0===a?e:"<a class='word fw-bold'>"+e.replace(/\s\s+/g," ")+"</a>"})),-1==t.search(o.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"))&&(t+="<blockquote cite='"+a.source_uri+"'>",t+="<p>"+o+"</p>",t+="<cite>"+(""==a.author?"Anonymous":a.author),t+=", <a href='"+a.source_uri+"' target='_blank'>"+a.title+"</a></cite>",t+="</blockquote>",n++))}})),""==t)return $("#card-header").html("Skipped. No examples found."),s++,void c(r[s]);$("#card").data("word",e),$("#card-loader").addClass("d-none"),$("#card-counter").text(d+1+"/"+o),$("#card-header").html(e),$("#card-text").append(t),$(".btn-answer").prop("disabled",!1),s++,d++})).fail((function(e,a,t){showMessage("Oops! There was an unexpected error trying to fetch example sentences for this word.","alert-danger")})))}function i(e){if((e.match(/"/g)||[]).length%2!=0){if(e.length<=4)return e;let a=e.substring(0,2).replace('"',""),t=e.substring(e.length-2).replace('"',"");return a+e.substring(2,e.length-2)+t}return e}function u(e){const t=e.parent("p").text().trim();return a.replace("%s",encodeURIComponent(t))}$("#btn-translate").removeClass("ps-0"),$("#btnremove").hide(),$("#btnadd").hide(),$("#btncancel").removeClass().addClass("btn-close me-1").html(""),$(".modal-header").addClass("p-0"),$(".btn-answer").prop("disabled",!0),$.ajax({url:"/ajax/getdicuris.php",type:"GET",dataType:"json"}).done((function(t){null==t.error_msg&&(e=t.dictionary_uri,a=t.translator_uri)})),$.ajax({type:"POST",url:"ajax/getcards.php",dataType:"json"}).done((function(e){r=e.map((function(e,a){return e.word.replace(/\r?\n|\r/g," ")})),o=r.length>o?o:r.length,$("#card-counter").text("1/"+o),c(r[0])})).fail((function(e,a,t){showMessage("Oops! There was an unexpected error trying to fetch the list of words you are learning in this language.","alert-danger")})),$("body").on("click",".word",(function(a){n=$(this);const r=e.replace("%s",encodeURI(n.text()));$("#btnadd").text("Forgot"),$("#loading-spinner").attr("class","lds-ellipsis m-auto"),t.attr("class","d-none"),t.get(0).contentWindow.location.replace(r),$("#dic-modal").modal("show")})),t.on("load",(function(){$("#loading-spinner").attr("class","d-none"),t.removeClass()})),$(".btn-answer").click((function(e){e.preventDefault();const a=$("#card").data("word"),t=$(this).attr("value");l[t][1]=l[t][1]+1,$(".btn-answer").prop("disabled",!0),$.ajax({type:"POST",url:"ajax/updatecard.php",data:{word:a,answer:t}}).done((function(e){c(r[s])})).fail((function(e,a,t){showMessage("There was an unexpected error updating this word's status","alert-danger")}))})),$("#btn-translate").on("click",(function(){window.open(u(n))})),$(document).on("contextmenu",(function(e){return!/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)&&$(e.target).is(".word")&&window.open(u($(e.target))),!1})),$(document).keypress((function(e){if(!$(".btn-answer").prop("disabled"))switch(e.which){case 49:$("#btn-answer-no-recall").click();break;case 50:$("#btn-answer-fuzzy").click();break;case 51:$("#btn-answer-partial").click();break;case 52:$("#btn-answer-excellent").click();break;default:break}}))}));