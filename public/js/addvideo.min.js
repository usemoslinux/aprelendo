$(document).ready((function(){function e(e){t();const a=function(e){if(""==e)return"";if(0===e.lastIndexOf("https://youtu.be/"))return e.slice(17);{const t=new Array("https://www.youtube.com/watch","https://youtube.com/watch","https://m.youtube.com/watch"),a=e.split("?"),o=a[1].split("&");for(const e of t)if(0===a[0].lastIndexOf(e))for(const e of o)if(0===e.lastIndexOf("v="))return e.substring(2)}}(e);if(""!=a){const t="https://www.youtube.com/embed/"+a;$("#btn-fetch-img").removeClass().addClass("spinner-border spinner-border-sm text-warning"),$.ajax({type:"POST",url:"ajax/fetchvideo.php",data:{video_id:a}}).done((function(a){void 0!==a&&(void 0!==a.error_msg?showMessage(a.error_msg,"alert-danger"):($("#yt-video").length&&$("#yt-video").get(0).contentWindow.location.replace(t),$("#title").val(a.title),$("#author").val(a.author),$("#url").val(e),""==a.text?($("#text").val(""),showMessage("This video does not include valid subtitles.","alert-danger")):($("#text").val(a.text),$("#alert-box").addClass("d-none"))))})).fail((function(e,t,a){showMessage("Oops! There was an unexpected error trying to get that video. Please try again later.","alert-danger")})).always((function(){$("#btn-fetch-img").removeClass().addClass("bi bi-arrow-down-right-square text-warning")}))}else showMessage('Malformed Youtube URL link. It should have the following format: https://www.youtube.com/watch?v=video_id or https://youtu.be/video_id. Remember to replace "video_id" with the corresponding video ID and try again.',"alert-danger")}function t(){0==$("#external_call").length&&($("input").not(":hidden").val(""),$("#text").val(""),$("#yt-video").attr("src","about:blank"))}t(),$("#url").focus(),$("#form-addvideo").on("submit",(function(e){e.preventDefault();const t=$("#form-addvideo").serializeArray();t.push({name:"shared-text",value:!0}),$.ajax({type:"POST",url:"ajax/addtext.php",data:t}).done((function(e){void 0!==e?void 0!==e.error_msg&&showMessage(e.error_msg,"alert-danger"):window.location.replace("/sharedtexts")})).fail((function(e,t,a){showMessage("Oops! There was an unexpected error when uploading this text.","alert-danger")}))})),$("#external_call").length&&e($("#url").val()),$("#btn-fetch").on("click",(function(t){e($("#url").val())})),$("#url").on("paste",(function(t){e(t.originalEvent.clipboardData.getData("text"))}))}));