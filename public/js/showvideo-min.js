$(document).ready((function(){var e,t,a,n,o=!1,r=null;dictionary_URI="",translator_URI="";var i="";prevsel=0,resume_video=!1,video_paused=!0;var d=!0;$.ajax({url:"ajax/getdicuris.php",type:"GET",dataType:"json"}).done((function(e){null==e.error_msg&&(dictionary_URI=e.dictionary_uri,translator_URI=e.translator_uri)})),$(document).on("mousedown touchstart",".word",(function(n){n.preventDefault(),n.stopPropagation(),video_paused||(player.pauseVideo(),resume_video=!0),n.which<2&&(o=!0,e=t=$(this),"touchstart"==n.type&&(a=new Date))})),$(document).on("mouseup touchend",".word",(function(d){d.preventDefault(),d.stopPropagation(),n=new Date,"touchend"==d.type&&n-a<1e3||d.which<2&&(o=!1,e===t&&(r=$(this)),function(){var e=$("html").attr("lang");o=r.text(),d=e,s=$("#bdgfreqlvl"),$.ajax({type:"GET",url:"/ajax/getwordfreq.php",data:{word:o,lg_iso:d}}).done((function(e){0==e?s.hide():e<81?s.hide().text("High frequency word").removeClass().addClass("badge badge-danger").show():s.hide().text("Medium frequency word").removeClass().addClass("badge badge-warning").show()})),t=$("#btnremove"),a=$("#btnadd"),$("#btncancel"),n=r.filter(".learning, .new, .forgotten, .learned").length,r.filter(".word").length==n?!1===t.is(":visible")&&(t.show(),a.text("Forgot")):(t.hide(),a.text("Add")),$("#iframe-loader").attr("class","lds-ripple m-auto"),$("#dicFrame").attr("class","d-none"),i=function(){var e=r.prevUntil(":contains('.')").last();e=e.length>0?e:r;var t=r.prev().nextUntil(":contains('.')").last().next();t=t.length>0?t:r.nextAll().last().next();var a=e.nextUntil(t).addBack().next().addBack().text().replace(/(\r\n|\n|\r)/gm," ");return translator_URI.replace("%s",encodeURIComponent(a))}();var t,a,n;var o,d,s;var l=r.text().replace(/(\r\n|\n|\r)/gm," "),c=dictionary_URI.replace("%s",encodeURIComponent(l));$(parent.document).find("#dicFrame").get(0).contentWindow.location.replace(c),$("#btnadd").focus(),$(parent.document).find("#myModal").modal("show")}())})),$.fn.isAfter=function(e){return this.prevUntil(e).length!==this.prevAll().length},$(document).on("mouseover touchmove",".word",(function(i){i.preventDefault(),i.stopPropagation(),n=new Date,"touchmove"==i.type&&n-a<1e3||o&&($(".word").removeClass("highlighted"),t="mouseover"===i.type?$(this):$(document.elementFromPoint(i.originalEvent.touches[0].clientX,i.originalEvent.touches[0].clientY)),e.parent().get(0)===t.parent().get(0)?t.isAfter(e)?(e.nextUntil(t.next(),".word").addBack().addClass("highlighted"),r=e.nextUntil(t.next()).addBack()):(e.prevUntil(t.prev(),".word").addBack().addClass("highlighted"),r=t.nextUntil(e.next()).addBack()):t=r=e)})),$("#btnadd").on("click",(function(){var e=r.text(),t=r.length>1?1:0;$.ajax({type:"POST",url:"ajax/addword.php",data:{word:e.toLowerCase(),is_phrase:t}}).done((function(){if(t){var a=r.eq(0).text(),n=r.filter(".word").length;$("span.word").filter((function(){return $(this).text().toLowerCase()===a.toLowerCase()})).each((function(){var t=$(this).nextAll("span.word").slice(0,n-1).last(),a=$(this).nextUntil(t).addBack().next("span.word").addBack();a.text().toLowerCase()===e.toLowerCase()&&($(this).is(".new, .learning, .learned, .forgotten")?a.wrapAll("<span class='word reviewing forgotten' data-toggle='modal' data-target='#myModal'></span>"):a.wrapAll("<span class='word reviewing new' data-toggle='modal' data-target='#myModal'></span>"),a.contents().unwrap())}))}else{var o=$("span.word").filter((function(){return $(this).text().toLowerCase()===e.toLowerCase()}));o.each((function(){var e=$(this);e.is(".new, .learning, .learned, .forgotten")?e.wrap("<span class='word reviewing forgotten' data-toggle='modal' data-target='#myModal'></span>"):e.wrap("<span class='word reviewing new' data-toggle='modal' data-target='#myModal'></span>")})),o.contents().unwrap()}})).fail((function(e,t,a){alert("Oops! There was an error adding this word or phrase to the database.")}))})),$("#btnremove").on("click",(function(){$.ajax({type:"POST",url:"ajax/removeword.php",data:{word:r.text().toLowerCase()}}).done((function(){var e=$("span.word").filter((function(){return $(this).text().toLowerCase()===r.text().toLowerCase()}));$.ajax({url:"ajax/underlinewords.php",type:"POST",data:{txt:r.text(),is_ebook:!1}}).done((function(t){e.removeClass(),e.addClass("word")}))})).fail((function(e,t,a){alert("Oops! There was an error removing the word from the database.")}))})),$("#btn-save").on("click",(function(){var e=[],t=[],a="";$(".learning").each((function(){a=$(this).text().toLowerCase(),-1==jQuery.inArray(a,e)&&e.push(a)})),t.push($("#text-container").attr("data-textID")),$.ajax({type:"POST",url:"ajax/archivetext.php",data:{words:e,textIDs:JSON.stringify(t)}}).done((function(e){d=!1,window.location.replace("texts.php")})).fail((function(e,t,a){alert("Oops! There was an error updating the database.")}))})),$("#myModal").on("hidden.bs.modal",(function(){resume_video&&(player.playVideo(),resume_video=!1),r.removeClass("highlighted")})),$("#dicFrame").on("load",(function(){$("#iframe-loader").attr("class","d-none"),$(this).removeClass()})),$("#btn-translate").on("click",(function(){window.open(i)})),$("#text-container").on("click",(function(e){e.preventDefault(),e.stopPropagation(),o=!1,$("#text-container").find(".highlighted").removeClass("highlighted")})),$(window).on("beforeunload",(function(){if(d)return"To save your progress, please click the Save button before you go. Otherwise, your changes will be lost. Are you sure you want to exit this page?"}))}));