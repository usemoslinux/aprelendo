$(document).ready((function(){function t(t,e){$("#alert-msg").html(t).removeClass().addClass("alert "+e),$(window).scrollTop(0)}function e(){const t=$("#text"),e=$("#span-chars-left"),a=1e4-t.val().length;a<0?(e.removeClass("text-success").addClass("text-danger"),e.html(a.toLocaleString()+" for Text-to-Speech (TTS) Support")):(e.removeClass("text-danger").addClass("text-success"),e.text(a.toLocaleString()+" left"))}function a(e){var a,n;a=!0,$("#alert-msg").addClass("d-none"),$("#type").prop("selectedIndex",0),$("#title").val(""),$("#author").val(""),$("#title").val(""),$("#text").val(""),$("#upload-text").val(""),a||$("#url").val(""),n=e,new RegExp(/[-a-zA-Z0-9@:%_\+.~#?&//=]{2,256}\.[a-z]{2,4}\b(\/[-a-zA-Z0-9@:%_\+.~#?&//=]*)?/gi).test(n)&&($("#btn-fetch-img").removeClass().addClass("fas fa-sync fa-spin text-warning"),$.ajax({type:"GET",url:"ajax/fetchurl.php",data:{url:e}}).done((function(e){if(null!=e.error_msg)t(e.error_msg,"alert-danger");else if(void 0!==e&&0!=e.length){const t=document.implementation.createHTMLDocument("New Document");t.body.parentElement.innerHTML=e;const a=new Readability(t).parse();$("#title").val($("<input>").html(a.title).text()),$("#author").val($("<input>").html(a.byline).text());let n="",r=$("<output>").append($.parseHTML(a.content));$("p, h1, h2, h3, h4, h5, h6",r).each((function(){n+=$(this).text().replace(/\s+/g," ")+"\n\n"})),n=n.replace(/(\n){3,}/g,"\n"),n=n.replace(/\t/g,""),$("#text").val($.trim(n)),$("#text").trigger("input")}else t("Oops! There was an error trying to fetch this text.","alert-danger")})).fail((function(e,a,n){t("Oops! There was an error trying to fetch this text.","alert-danger")})).always((function(){$("#btn-fetch-img").removeClass().addClass("fas fa-arrow-down text-warning")})))}$("#external_call").length&&a($("#url").val()),$("#form-addtext").on("submit",(function(e){e.preventDefault();const a=new FormData(document.getElementById("form-addtext"));$.ajax({type:"POST",url:"ajax/addtext.php",data:a,dataType:"json",contentType:!1,processData:!1}).done((function(e){void 0!==e?t(e.error_msg,"alert-danger"):"on"==a.get("shared-text")?window.location.replace("/sharedtexts"):window.location.replace("/texts")})).fail((function(e,a,n){t("Oops! There was an unexpected error when uploading this text.","alert-danger")}))})),$("#text").on("input",(function(){e()})),$("#upload-text").on("change",(function(){const t=$(this)[0].files[0],a=new FileReader;a.onload=function(t){const a=t.target.result;$("#text").val($.trim(a)),e()},a.readAsText(t),$(this).val("")})),$("#btn-fetch").on("click",(function(t){a($("#url").val())})),$("#url").on("paste",(function(t){const e=$("#text").val();if(!e||/^\s*$/.test(e)){a(t.originalEvent.clipboardData.getData("text"))}})),$("#text").text().length>0&&$("#text").trigger("input")}));