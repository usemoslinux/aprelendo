$(document).ready((function(){var e="",a="",r=$("#dicFrame"),t=$(),n=[],o=20,d=0,c=0;function l(e,a){$("#alert-msg").html(e).removeClass().addClass("alert "+a),$(window).scrollTop(0)}function s(e){(function(){if(0==o)return $("#card-header").text("Sorry, no cards to practice"),$("#card-text").html("<i class='fas fa-exclamation-circle text-danger display-3'></i><br><br>It seems you don't have any cards left for learning."),$("#card-footer").addClass("d-none"),$("#card-loader").addClass("d-none"),!0;if(c>o-1)return $("#card-header").text("This is the end, my friend"),$("#card-text").html("<i class='fas fa-check-circle text-success display-3'></i><br><br>You have reached the end of your practice."),$("#card-footer").addClass("d-none"),$("#card-loader").addClass("d-none"),!0;return!1})()||($("#card-loader").removeClass("d-none"),$("#card-text").empty(),$("#card-header").html("Looking for examples of <b>"+e+"</b>..."),$.ajax({type:"POST",url:"ajax/getcards.php",data:{word:e},dataType:"json"}).done((function(a){var r="",t=0;const l=new RegExp("[^\\n.?!]*(?<![\\p{L}])"+e+"(?![\\p{L}])[^\\n.?!]*[.?!\\n)]","gmiu"),i=new RegExp("(?<![\\p{L}|\\d])"+e+"(?![\\p{L}|\\d])","gmiu");if(a.forEach((e=>{for(;null!==(m=l.exec(e.text));)m.index===l.lastIndex&&l.lastIndex++,t<3&&m.forEach(((e,a)=>{e=e.replace(i,(function(e,a){return void 0===a?e:"<a class='word font-weight-bold'>"+e.replace(new RegExp("\\s\\s+","g")," ")+"</a>"})),r+=r.search(e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"))>0?"":"<p>"+e+"</p>\n",t++}))})),""==r)return $("#card-header").html("Skipped <b>"+e+"</b>. No examples found."),d++,void s(n[d]);$("#card").data("word",e),$("#card-loader").addClass("d-none"),$("#card-counter").text(c+1+"/"+o),$("#card-header").html("<h3 class='m-0'>"+e+"</h3>"),$("#card-text").append(r),$(".btn-remember").prop("disabled",!1),d++,c++})).fail((function(e,a,r){l("Oops! There was an unexpected error trying to fetch example sentences for this word.","alert-danger")})))}$("#btn-translate").removeClass("pl-0"),$("#btnremove").hide(),$("#btnadd").hide(),$("#btncancel").addClass("ml-auto").html("&#x2715"),$(".modal-header").addClass("p-0"),$(".btn-remember").prop("disabled",!0),$.ajax({url:"/ajax/getdicuris.php",type:"GET",dataType:"json"}).done((function(r){null==r.error_msg&&(e=r.dictionary_uri,a=r.translator_uri)})),$.ajax({type:"POST",url:"ajax/getcards.php",dataType:"json"}).done((function(e){n=e.map((function(e,a){return e.word})),o=n.length>o?o:n.length,$("#card-counter").text("1/"+o),s(n[0])})).fail((function(e,a,r){l("Oops! There was an unexpected error trying to fetch the list of words you are learning in this language.","alert-danger")})),$("body").on("click",".word",(function(a){t=$(this);var n=e.replace("%s",encodeURI(t.text()));$("#btnadd").text("Forgot"),$("#iframe-loader").attr("class","lds-ellipsis m-auto"),r.attr("class","d-none"),r.get(0).contentWindow.location.replace(n),$("#myModal").modal("show")})),$("#myModal").on("show.bs.modal",(function(e){window.location.hash="dictionary"})),$(window).on("hashchange",(function(e){"#dictionary"!=window.location.hash&&$("#myModal").modal("hide")})),$("#myModal").on("hide.bs.modal",(function(e){history.pushState("",document.title,window.location.pathname+window.location.search)})),r.on("load",(function(){$("#iframe-loader").attr("class","d-none"),r.removeClass()})),$(".btn-remember").click((function(e){e.preventDefault();var a=$("#card").data("word"),r="btn-remember-yes"==e.currentTarget.id;$(".btn-remember").prop("disabled",!0),$.ajax({type:"POST",url:"ajax/updatecard.php",data:{word:a,remember:r}}).done((function(e){s(n[d])})).fail((function(e,a,r){l("There was an unexpected error updating this word's status","alert-danger")}))})),$("#btn-translate").on("click",(function(){var e;window.open((e=t.parent("p").text().trim(),a.replace("%s",encodeURIComponent(e))))}))}));