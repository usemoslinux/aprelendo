$(document).ready((function(){function e(e,a){$("#alert-msg").html(e).removeClass().addClass("alert "+a),$(window).scrollTop(0)}function a(e){$("#upload-progress-bar").parent().addClass("d-none"),$("#btn-upload-epub").removeClass("disabled"),$("#btn-save").removeClass("disabled"),e&&($("#title").val(""),$("#author").val(""),$("#url").val(""))}function t(e){var a=ePub(),t=e.target.result;a.open(t),a.loaded.metadata.then((function(e){var a=document.getElementById("title"),t=document.getElementById("author");null!=a&&(a.value=e.title,t.value=e.creator)})),window.addEventListener("unload",(function(){a.destroy()}))}a(!0),$("#btn-upload-epub").on("click",(function(){$("#url").trigger("click")})),$("#url").on("change",(function(){$("#alert-msg").addClass("d-none");var n=$(this),l=n[0].files[0].name.split(".").pop().toLowerCase();if(n[0].files[0].size>2097152)e("This file is bigger than the allowed limit (2 MB). Please try again.","alert-danger"),a(!0);else if("epub"!=l)e("Invalid file extension. Only .epub files are allowed.","alert-danger"),a(!0);else if(window.FileReader){var r=new FileReader;r.onload=t,r.readAsArrayBuffer(n[0].files[0])}})),$("#form-addebook").on("submit",(function(t){t.preventDefault();var n=$("#upload-progress-bar"),l=new FormData(document.getElementById("form-addebook"));$("#alert-msg").addClass("d-none"),n.parent().removeClass("d-none"),$("#btn-upload-epub").addClass("disabled"),$("#btn-save").addClass("disabled"),n.width("33%"),n.text("Uploading epub file..."),$.ajax({type:"POST",url:"ajax/addtext.php",data:l,dataType:"json",contentType:!1,processData:!1}).done((function(t){null!=t.error_msg?(e(t.error_msg,"alert-danger"),a(!1)):(n.width("66%"),n.text("Validating epub file..."),$.ajax({type:"POST",url:"ajax/validateepub.php",data:{filename:t.filename}}).done((function(e){null!=e.error_msg?(n.width("100%"),n.removeClass("progress-bar-success").addClass("progress-bar-danger"),n.text(e.error_msg),n.parent().delay(4e3).fadeOut("slow",(function(){window.location.replace("/texts")}))):(n.width("100%"),n.text("Upload complete..."),n.parent().delay(1500).fadeOut("slow",(function(){window.location.replace("/texts")})))})).fail((function(t,n,l){e("Oops! There was an unexpected error uploading this text.","alert-danger"),a(!1)})))})).fail((function(t,n,l){e("Oops! There was an unexpected error uploading this text.","alert-danger"),a(!1)}))}))}));