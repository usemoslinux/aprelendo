$(document).ready((function(){async function t(t){try{e();const o=function(t){if(""==t)return"";if(0===t.lastIndexOf("https://youtu.be/"))return t.slice(17);{const e=new Array("https://www.youtube.com/watch","https://youtube.com/watch","https://m.youtube.com/watch");if(!t.includes("?"))return"";const a=t.split("?"),o=a[1].split("&");for(const t of e)if(0===a[0].lastIndexOf(t))for(const t of o)if(0===t.lastIndexOf("v="))return t.substring(2)}}(t);if(""==o)throw new Error('Malformed Youtube URL link. It should have the following format:\n                    https://www.youtube.com/watch?v=video_id or https://youtu.be/video_id.\n                    Remember to replace "video_id" with the corresponding video ID and try again.');const r="https://www.youtube.com/embed/"+o;$("#btn-fetch-img").removeClass().addClass("spinner-border spinner-border-sm text-warning");const n=new URLSearchParams({video_id:o}),s=await fetch("/ajax/fetchvideo.php",{method:"POST",body:n});if(!s.ok)throw new Error(`HTTP error: ${s.status}`);const i=await s.json();if(!i.success)throw new Error(i.error_msg||"Failed to fetch video data");if($("#yt-video").length&&$("#yt-video").get(0).contentWindow.location.replace(r),$("#title").val((a=i.payload.title).charAt(0).toUpperCase()+a.slice(1).toLowerCase()),$("#author").val(i.payload.author),$("#url").val(t),""==i.payload.text)throw $("#text").val(""),new Error("There are no subtitles available for this video.");$("#text").val(i.payload.text),$("#alert-box").addClass("d-none")}catch(t){showMessage(t.message,"alert-danger")}finally{$("#btn-fetch-img").removeClass().addClass("bi bi-arrow-down-right-square text-warning")}var a}function e(){0==$("#external_call").length&&($("input").not(":hidden").val(""),$("#text").val(""),$("#yt-video").attr("src","about:blank"))}e(),$("#url").trigger("focus"),$("#form-addvideo").on("submit",(async function(t){t.preventDefault();const e=$("#form-addvideo").serializeArray();e.push({name:"shared-text",value:!0});try{const t=new URLSearchParams;e.forEach((e=>t.append(e.name,e.value)));const a=await fetch("/ajax/addtext.php",{method:"POST",body:t});if(!a.ok)throw new Error(`HTTP error: ${a.status}`);const o=await a.json();if(!o.success)throw new Error(o.error_msg||"Failed to add video");window.location.replace("/sharedtexts")}catch(t){showMessage(t.message,"alert-danger")}})),$("#external_call").length&&t($("#url").val()),$("#btn-fetch").on("click",(function(e){t($("#url").val())})),$("#url").on("paste",(function(e){t(e.originalEvent.clipboardData.getData("text"))}))}));