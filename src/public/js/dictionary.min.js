function getTextSentence(t){let n=t.prevUntil(":contains('.'), :contains('!'), :contains('?'), :contains('\n')").last();n=n.length>0?n:t;let e=0==t.prev().length?t.nextUntil(":contains('.'), :contains('。'), :contains('!'), :contains('?'), :contains('\n')").last().next():t.prev().nextUntil(":contains('.'), :contains('。'), :contains('!'), :contains('?'), :contains('\n')").last().next();e=e.length>0?e:t.nextAll().last().next();let i=e.text().length,o=n.nextUntil(e).addBack().next().addBack().text().replace(/(\r\n|\n|\r)/gm," ");return i>1&&o.slice(0,1-i),o.replace(/\r?\n|\r/g," ").trim()}function buildTextTranslationLink(t,n){let e=getTextSentence(n);return t.replace("%s",encodeURI(e))}function getVideoSentence(t){let n,e=t,i=$(),o="",r=!1;const c=":contains('.'), :contains('。'), :contains('!'), :contains('?')";for(;!r;){if(0===e.index()){o=e.text().replace(/(\r\n|\n|\r)/gm," ").trim();break}if(e.filter(c).length>0)break;n=e.prevAll(c).next().last(),r=n.length>0||e.filter(c).length>0,n=r?n:e.siblings().addBack().first(),i=n.nextUntil(e).addBack().next().addBack(),o=i.text().replace(/(\r\n|\n|\r)/gm," ").trim()+"\n"+o,e=e.parent().prev().children().last(),r=r||0===e.length}n=0===t.next().length?t:t.next();let a;for(r=o.match(/[.。!?]/g);!r;)e=n.nextAll(c).first(),e=e.index()===e.parent().children().length?n:e,r=e.length>0||n.filter(c).length>0,e=r?e:n.siblings().last(),n.filter(c).length>0?(i=n,a=""):(i=n.nextUntil(e).addBack().next().addBack(),a="\n"),o=o.trim()+a+i.text().replace(/(\r\n|\n|\r)/gm," ").trim(),n=n.parent().next().children().first(),r=r||0===n.length;return o.replace(/\r?\n|\r/g," ").trim()}function buildVideoTranslationLink(t,n){let e=getVideoSentence(n);return t.replace("%s",encodeURIComponent(e))}function buildStudyTranslationLink(t,n){const e=n.parent("p").text().trim()||n.text();return t.replace("%s",encodeURIComponent(e))}function buildDictionaryLink(t,n){const e=n.trim().replace(/\r?\n|\r/gm," ");return t.replace("%s",encodeURIComponent(e))}function setWordActionButtons(t,n){let e=$("#word-actions-g1")||$(parent.document).find("#word-actions-g1"),i=$("#word-actions-g2")||$(parent.document).find("#word-actions-g2");if(n)return e.hide(),void i.hide();const o=t.filter(".learning, .new, .forgotten, .learned").length;t.filter(".word").length==o?(e.hide(),i.show()):(e.show(),i.hide())}function getWordFrequency(t){return 100==t?"Medium/low":t<81?"Very high":t<97?"High":void 0}function showActionButtons(t){const n=$("#action-buttons"),e=n.outerWidth(),i=$(window).width(),o=t.offset(),r=t.outerWidth();o.left+e>i?n.css({top:o.top-n.outerHeight()-2,left:o.left-e+r}):n.css({top:o.top-n.outerHeight()-2,left:o.left}),n.show()}function hideActionButtons(t){$("#action-buttons").hide()}function setDicActionButtonsClick(t,n,e){const i=buildDictionaryLink(n.dictionary,t.text()),o=buildDictionaryLink(n.img_dictionary,t.text());let r="";switch(e){case"text":r=buildTextTranslationLink(n.translator,t);break;case"video":r=buildVideoTranslationLink(n.translator,t);break;case"study":r=buildStudyTranslationLink(n.translator,t);break;default:break}$("#btn-open-dict").off("click").on("click",(function(){openInNewTab(i)})),$("#btn-open-img-dict").off("click").on("click",(function(){openInNewTab(o)})),$("#btn-open-translator").off("click").on("click",(function(){openInNewTab(r)})),$("#btn-open-ai-bot-modal").off("click").on("click",(function(){const n=$("#ask-ai-bot-modal");n.attr("data-word",t.text()),n.modal("show")}))}