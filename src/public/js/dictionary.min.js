function getTextSentence(n){let e=n.prevUntil(":contains('.'), :contains('!'), :contains('?'), :contains('\n')").last();e=e.length>0?e:n;let t=0==n.prev().length?n.nextUntil(":contains('.'), :contains('。'), :contains('!'), :contains('?'), :contains('\n')").last().next():n.prev().nextUntil(":contains('.'), :contains('。'), :contains('!'), :contains('?'), :contains('\n')").last().next();t=t.length>0?t:n.nextAll().last().next();let r=t.text().length,i=e.nextUntil(t).addBack().next().addBack().text().replace(/(\r\n|\n|\r)/gm," ");return r>1&&i.slice(0,1-r),i.trim()}function buildTextTranslationLink(n,e){let t=getTextSentence(e);return n.replace("%s",encodeURI(t))}function getVideoSentence(n){let e,t=n,r=$(),i="",a=!1;const l=":contains('.'), :contains('。'), :contains('!'), :contains('?')";for(;!a;){if(0===t.index()){i=t.text().replace(/(\r\n|\n|\r)/gm," ").trim();break}if(t.filter(l).length>0)break;e=t.prevAll(l).next().last(),a=e.length>0||t.filter(l).length>0,e=a?e:t.siblings().addBack().first(),r=e.nextUntil(t).addBack().next().addBack(),i=r.text().replace(/(\r\n|\n|\r)/gm," ").trim()+"\n"+i,t=t.parent().prev().children().last(),a=a||0===t.length}e=0===n.next().length?n:n.next();let o;for(a=i.match(/[.。!?]/g);!a;)t=e.nextAll(l).first(),t=t.index()===t.parent().children().length?e:t,a=t.length>0||e.filter(l).length>0,t=a?t:e.siblings().last(),e.filter(l).length>0?(r=e,o=""):(r=e.nextUntil(t).addBack().next().addBack(),o="\n"),i=i.trim()+o+r.text().replace(/(\r\n|\n|\r)/gm," ").trim(),e=e.parent().next().children().first(),a=a||0===e.length;return i.trim()}function buildVideoTranslationLink(n,e){let t=getVideoSentence(e);return n.replace("%s",encodeURIComponent(t))}function buildStudyTranslationLink(n,e){const t=e.parent("p").text().trim();return n.replace("%s",encodeURIComponent(t))}function buildDictionaryLink(n,e){const t=e.trim().replace(/\r?\n|\r/gm," ");return n.replace("%s",encodeURIComponent(t))}function setAddDeleteButtons(n){let e=$("#btn-remove")||$(parent.document).find("#btn-remove"),t=$("#btn-add")||$(parent.document).find("#btn-add");const r=n.filter(".learning, .new, .forgotten, .learned").length;n.filter(".word").length==r?!1===e.is(":visible")&&(e.show(),t.text("Forgot").removeClass("btn-primary").addClass("btn-danger")):(e.hide(),t.text("Add").removeClass("btn-danger").addClass("btn-primary"))}function getWordFrequency(n,e){let t=$("#bdgfreqlvl")||$(parent.document).find("#bdgfreqlvl");$.ajax({type:"GET",url:"/ajax/getwordfreq.php",data:{word:n,lg_iso:e}}).done((function(n){0==n?t.hide():n<81?t.hide().text("High frequency word").removeClass().addClass("badge text-bg-danger").show():n<97&&t.hide().text("Medium frequency word").removeClass().addClass("badge text-bg-warning").show()})).fail((function(){t.hide()}))}