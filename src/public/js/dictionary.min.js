function getTextSentence(t){let n=t.prevUntil(":contains('.'), :contains('!'), :contains('?'), :contains('\n')").last();n=n.length>0?n:t;let e=0==t.prev().length?t.nextUntil(":contains('.'), :contains('。'), :contains('!'), :contains('?'), :contains('\n')").last().next():t.prev().nextUntil(":contains('.'), :contains('。'), :contains('!'), :contains('?'), :contains('\n')").last().next();e=e.length>0?e:t.nextAll().last().next();let i=e.text().length,o=n.nextUntil(e).addBack().next().addBack().text().replace(/(\r\n|\n|\r)/gm," ");return i>1&&o.slice(0,1-i),o.replace(/\s+/g," ").trim()}function buildTextTranslationLink(t,n){let e=getTextSentence(n);return t.replace("%s",encodeURI(e))}function getVideoSentence(t){let n,e=t,i=$(),o="",c=!1;const a=":contains('.'), :contains('。'), :contains('!'), :contains('?')";for(;!c;){if(0===e.index()){o=e.text().replace(/(\r\n|\n|\r)/gm," ").trim();break}if(e.filter(a).length>0)break;n=e.prevAll(a).next().last(),c=n.length>0||e.filter(a).length>0,n=c?n:e.siblings().addBack().first(),i=n.nextUntil(e).addBack().next().addBack(),o=i.text().replace(/(\r\n|\n|\r)/gm," ").trim()+"\n"+o,e=e.parent().prev().children().last(),c=c||0===e.length}n=0===t.next().length?t:t.next();let r;for(c=o.match(/[.。!?]/g);!c;)e=n.nextAll(a).first(),e=e.index()===e.parent().children().length?n:e,c=e.length>0||n.filter(a).length>0,e=c?e:n.siblings().last(),n.filter(a).length>0?(i=n,r=""):(i=n.nextUntil(e).addBack().next().addBack(),r="\n"),o=o.trim()+r+i.text().replace(/(\r\n|\n|\r)/gm," ").trim(),n=n.parent().next().children().first(),c=c||0===n.length;return o.replace(/\s+/g," ").trim()}function buildVideoTranslationLink(t,n){let e=getVideoSentence(n);return t.replace("%s",encodeURIComponent(e))}function buildStudyTranslationLink(t,n){const e=n.parent("p").text().trim()||n.text();return t.replace("%s",encodeURIComponent(e))}function buildDictionaryLink(t,n){const e=n.replace(/\s+/g," ").trim();return t.replace("%s",encodeURIComponent(e))}function setWordActionButtons(t,n){let e=$("#word-actions-g1")||$(parent.document).find("#word-actions-g1"),i=$("#word-actions-g2")||$(parent.document).find("#word-actions-g2");if(n)return e.hide(),void i.hide();const o=t.filter(".learning, .new, .forgotten, .learned").length;t.filter(".word").length==o?(e.hide(),i.show()):(e.show(),i.hide())}function getWordFrequency(t){return 100==t?"Medium/low":t<81?"Very high":t<97?"High":void 0}function showActionButtons(t){const n=$("#action-buttons"),e=n.outerWidth(),i=$(window).width(),o=t.offset(),c=t.outerWidth();o.left+e>i?n.css({top:o.top-n.outerHeight()-2,left:o.left-e+c}):n.css({top:o.top-n.outerHeight()-2,left:o.left}),n.show()}function hideActionButtons(t){$("#action-buttons").hide()}function setDicActionButtonsClick(t,n,e){const i=buildDictionaryLink(n.dictionary,t.text()),o=buildDictionaryLink(n.img_dictionary,t.text());let c="";switch(e){case"text":c=buildTextTranslationLink(n.translator,t);break;case"video":c=buildVideoTranslationLink(n.translator,t);break;case"study":c=buildStudyTranslationLink(n.translator,t);break;default:break}$("#btn-open-dict").off("click").on("click",(function(){openInNewTab(i)})),$("#btn-open-img-dict").off("click").on("click",(function(){openInNewTab(o)})),$("#btn-open-translator").off("click").on("click",(function(){openInNewTab(c)})),$("#btn-open-ai-bot-modal").off("click").on("click",(function(){const n=$("#ask-ai-bot-modal");n.attr("data-word",t.text()),n.modal("show")}))}