const Dictionaries=(()=>{let t={dictionary:"",img_dictionary:"",translator:""};return{fetchURIs:()=>{$.ajax({url:"/ajax/getdicuris.php",type:"GET",dataType:"json"}).done((function(n){null==n.error_msg&&(t.dictionary=n.dictionary_uri,t.img_dictionary=n.img_dictionary_uri,t.translator=n.translator_uri)}))},getWordFrequency:t=>100==t?"Medium/low":t<81?"Very high":t<97?"High":void 0,getURIs:()=>t}})(),SentenceExtractor={extractSentence:function(t){const n=/[.!?\u3002\uFF01\uFF1F]/,e=TextProcessor.getAnchorsList(),o=TextProcessor.getAnchorIndex(t);if(o<0||o>=e.length)return"";let i=o;for(;i>0;){const t=$(e[i-1]).text();if(n.test(t))break;i--}let r=o;for(;r<e.length-1;){const t=$(e[r+1]).text();if(n.test(t)){r++;break}r++}let c="";for(let t=i;t<=r;t++)c+=$(e[t]).text();return c.replace(/(\r\n|\n|\r)/g," ").trim()}},LinkBuilder={forWordInDictionary:(t,n)=>{const e=n.replace(/\s+/g," ").trim();return t.replace("%s",encodeURIComponent(e))},forTranslationInText:(t,n)=>{let e=SentenceExtractor.extractSentence(n);return t.replace("%s",encodeURI(e))},forTranslationInVideo:(t,n)=>{let e=SentenceExtractor.extractSentence(n);return t.replace("%s",encodeURIComponent(e))},forTranslationInStudy:(t,n)=>{const e=n.parent("p").text().trim()||n.text();return t.replace("%s",encodeURIComponent(e))}},ActionBtns={show:t=>{const n=$("#action-buttons"),e=n.outerWidth(),o=$(window).width(),i=t.offset(),r=t.outerWidth();i.left+e>o?n.css({top:i.top-n.outerHeight()-2,left:i.left-e+r}):n.css({top:i.top-n.outerHeight()-2,left:i.left}),n.show()},hide:t=>{$("#action-buttons").hide()},createWordActionBtns:(t,n)=>{let e=$("#word-actions-g1")||$(parent.document).find("#word-actions-g1"),o=$("#word-actions-g2")||$(parent.document).find("#word-actions-g2");if(n)return e.hide(),void o.hide();const i=t.filter(".learning, .new, .forgotten, .learned").length;t.filter(".word").length==i?(e.hide(),o.show()):(e.show(),o.hide())},bindDictionaryBtnsOnClick:(t,n)=>{const e=Dictionaries.getURIs(),o=LinkBuilder.forWordInDictionary(e.dictionary,t.text()),i=LinkBuilder.forWordInDictionary(e.img_dictionary,t.text());let r="";switch(n){case"text":r=LinkBuilder.forTranslationInText(e.translator,t);break;case"video":r=LinkBuilder.forTranslationInVideo(e.translator,t);break;case"study":r=LinkBuilder.forTranslationInStudy(e.translator,t);break;default:break}$("#btn-open-dict").off("click").on("click",(function(){openInNewTab(o)})),$("#btn-open-img-dict").off("click").on("click",(function(){openInNewTab(i)})),$("#btn-open-translator").off("click").on("click",(function(){openInNewTab(r)})),$("#btn-open-ai-bot-modal").off("click").on("click",(function(){const n=$("#ask-ai-bot-modal");n.attr("data-word",t.text()),n.modal("show")}))}},TextActionBtns={show:t=>{ActionBtns.createWordActionBtns(t,!1),$("body").disableScroll(),ActionBtns.bindDictionaryBtnsOnClick(t,"text"),ActionBtns.show(t)},hide:()=>{$("body").enableScroll(),ActionBtns.hide()}},VideoActionBtns={show:t=>{$("#text-container").disableScroll(),ActionBtns.createWordActionBtns(t,!1),ActionBtns.bindDictionaryBtnsOnClick(t,"video"),ActionBtns.show(t)},hide:()=>{$("#text-container").enableScroll(),ActionBtns.hide()}},StudyActionBtns={show:t=>{ActionBtns.createWordActionBtns(t,!0),ActionBtns.bindDictionaryBtnsOnClick(t,"study"),ActionBtns.show(t)},hide:()=>{ActionBtns.hide()}},OtherActionBtns={};