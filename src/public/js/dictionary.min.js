function getTextSentence(e){let n=e.prevUntil(":contains('.'), :contains('!'), :contains('?'), :contains('\n')").last();n=n.length>0?n:e;let t=0==e.prev().length?e.nextUntil(":contains('.'), :contains('。'), :contains('!'), :contains('?'), :contains('\n')").last().next():e.prev().nextUntil(":contains('.'), :contains('。'), :contains('!'), :contains('?'), :contains('\n')").last().next();t=t.length>0?t:e.nextAll().last().next();let r=t.text().length,a=n.nextUntil(t).addBack().next().addBack().text().replace(/(\r\n|\n|\r)/gm," ");return r>1&&a.slice(0,1-r),a.trim()}function buildTextTranslationLink(e,n){let t=getTextSentence(n);return e.replace("%s",encodeURI(t))}function getVideoSentence(e){let n,t=e,r=$(),a="",i=!1;const l=":contains('.'), :contains('。'), :contains('!'), :contains('?')";for(;!i;){if(0===t.index()){a=t.text().replace(/(\r\n|\n|\r)/gm," ").trim();break}if(t.filter(l).length>0)break;n=t.prevAll(l).next().last(),i=n.length>0||t.filter(l).length>0,n=i?n:t.siblings().addBack().first(),r=n.nextUntil(t).addBack().next().addBack(),a=r.text().replace(/(\r\n|\n|\r)/gm," ").trim()+"\n"+a,t=t.parent().prev().children().last(),i=i||0===t.length}n=0===e.next().length?e:e.next();let o;for(i=a.match(/[.。!?]/g);!i;)t=n.nextAll(l).first(),t=t.index()===t.parent().children().length?n:t,i=t.length>0||n.filter(l).length>0,t=i?t:n.siblings().last(),n.filter(l).length>0?(r=n,o=""):(r=n.nextUntil(t).addBack().next().addBack(),o="\n"),a=a.trim()+o+r.text().replace(/(\r\n|\n|\r)/gm," ").trim(),n=n.parent().next().children().first(),i=i||0===n.length;return a.trim()}function buildVideoTranslationLink(e,n){let t=getVideoSentence(n);return e.replace("%s",encodeURIComponent(t))}function buildStudyTranslationLink(e,n){const t=n.parent("p").text().trim();return e.replace("%s",encodeURIComponent(t))}function buildDictionaryLink(e,n){const t=n.trim().replace(/\r?\n|\r/gm," ");return e.replace("%s",encodeURIComponent(t))}function setAddDeleteButtons(e){let n=$("#btn-remove")||$(parent.document).find("#btn-remove"),t=$("#btn-add")||$(parent.document).find("#btn-add");const r=e.filter(".learning, .new, .forgotten, .learned").length;e.filter(".word").length==r?!1===n.is(":visible")&&(n.show(),t.text("Forgot").removeClass("btn-primary").addClass("btn-danger")):(n.hide(),t.text("Add").removeClass("btn-danger").addClass("btn-primary"))}function getWordFrequency(e,n){let t=$("#bdgfreqlvl")||$(parent.document).find("#bdgfreqlvl");return new Promise(((r,a)=>{$.ajax({type:"GET",url:"/ajax/getwordfreq.php",data:{word:e,lg_iso:n}}).done((function(e){0==e?t.removeClass().hide():e<81?t.removeClass().addClass("badge text-bg-danger").text("High frequency word").show():e<97&&t.removeClass().addClass("badge text-bg-warning").text("Medium frequency word").show(),r(e)})).fail((function(){t.removeClass().hide(),a(new Error("AJAX request failed"))}))}))}