$(document).ready((function(){let e=[],r=10,a=0,t=[["0",0,"bg-success","Excellent"],["1",0,"bg-warning","Partial"],["2",0,"bg-primary","Fuzzy"],["3",0,"bg-danger","No recall"]];function s(t){$("#study-card").data("word",t.word),function(){const e=Math.round((a+1)/r*100);$("#live-progress-bar").css("width",e+"%").attr("aria-valuenow",e)}(),$("#card-counter").text(a+1+"/"+r),$("#study-card-word-title").removeClass("placeholder").text(t.word),function(r){const t=$("#study-card-freq-badge");if(r)t.removeClass("placeholder").addClass("border border-light").text("Phrase/Expression");else{const r=Dictionaries.getWordFrequency(e[a].frequency_index)+" frequency";t.removeClass("placeholder").addClass("border border-light").text(r)}}(e[a].is_phrase),d(t.status)}function n(){if(0==r)return o(),!0;if(a>=r){$("#study-card-word-title").text("Congratulations!"),$("#study-card-freq-badge").hide(),d();let a="";for(const e of t){let t=e[1],s=t/r*100;a+="<div class='progress-bar "+e[2]+"' role='progressbar' aria-valuenow='"+s+"' aria-valuemin='0' aria-valuemax='100' style='width: "+s+"%' title='"+e[3]+": "+t+" answer(s)'>"+Math.round(s)+" %</div>"}return $("#ai-card").html("<div class='bi bi-trophy text-warning display-3 mt-3'></div><div class='mt-3'>You have reached the end of your study.</div><div class='mt-3'>These were your results:</div><div class='progress mx-auto mt-3 fw-bold' style='height: 25px;max-width: 550px'>"+a+"</div>"+function(){const r='<table class="table table-bordered table-striped text-end small mx-auto mt-3"\n            aria-describedby="" style="max-width: 550px">\n        <thead>\n            <tr class="table-light">\n                <th>Word</th>\n                <th>Recall level</th>\n            </tr>\n        </thead>\n        <tbody>';let a="";const s="</tbody></table>";return e.forEach((e=>{a+='<tr><td><a class="word bw-bold">'+e.word+'</a></td><td><span class="word-description '+t[e.status][2]+'">'+t[e.status][3]+"</span></td></tr>"})),r+a+s}()+"<div class='small mt-4'>If you want to continue, you can refresh this page (F5).<br>However, we strongly recommend that you keep your study sessions short and take rest intervals.</div>"),$("#study-card-footer").addClass("d-none"),$("#live-progress").addClass("d-none"),scrollToPageTop(),!0}return!1}function o(){$("#study-card-header").text("Sorry, no cards to practice"),d(3),$("#ai-card").html("<div class='bi bi-exclamation-circle text-danger display-3'></div><div class='mt-3'>It seems there are no cards in your deck. Add some words to your library and try again.</div>"),$("#study-card-footer").addClass("d-none"),$("#live-progress").addClass("d-none")}function d(e){const r=$("#study-card"),a=$("#study-card-header");switch(r.removeClass((function(e,r){return(r.match(/\bborder-\S+/g)||[]).join(" ")})),a.removeClass((function(e,r){return(r.match(/\bborder-\S+|\bbg-\S+/g)||[]).join(" ")})),e){case 0:r.addClass("border-success"),a.addClass("bg-gradient bg-success border-success");break;case 1:r.addClass("border-warning"),a.addClass("bg-gradient bg-warning border-warning");break;case 2:r.addClass("border-primary"),a.addClass("bg-gradient bg-primary border-primary");break;case 3:r.addClass("border-danger"),a.addClass("bg-gradient bg-danger border-danger");break;default:r.addClass("border-secondary"),a.addClass("bg-gradient bg-secondary border-secondary");break}}$(".btn-answer").prop("disabled",!0),Dictionaries.fetchURIs(),$.ajax({type:"POST",url:"ajax/getcards.php",data:{limit:r},dataType:"json"}).done((function(a){if(a.error_msg)showMessage("Oops! There was an unexpected error trying to fetch the list of words you are learning in this language.","alert-danger");else{if(0==a.length)return o(),!0;e=a.map((e=>({...e,word:e.word.replace(/\r?\n|\r/g," ")}))),r=e.length>r?r:e.length,s(e[0])}})).fail((function(e,r,a){showMessage("Oops! There was an unexpected error trying to fetch the list of words you are learning in this language.","alert-danger")})),$("#btn-submit-user-answer").click((function(){const e="Evaluate user response in two lines: first line with one of the four ratings (1) Completely incorrect (major mistakes or confused meaning); (2) Incorrect, but close (made some significant usage mistakes, but I was on the right track); (3) Mostly correct (made minor errors (missing details, awkward phrasing, etc.); or (4) Correct & comprehensive (perfect answer). Second line with a brief explanation and, if useful, a corrected version. Keep it concise.\n Question:"+$("#select-prompt").val()+"\n Answer: "+$("#text-user-answer").val();if(!e)return;const r=new showdown.Converter;$("#text-ai-answer").html("Retrieving response from Lingobot..."),AIBot.streamReply(e,{onUpdate(e){const a=r.makeHtml(e);$("#text-ai-answer").html(a)},onError(){$("#text-ai-answer").html("<p>Failed to get response from AI. Please try again.</p>")}}),$(".btn-answer").prop("disabled",!1)})),$(".btn-answer").click((function(r){r.preventDefault();const o=$("#study-card").data("word"),d=$(this).attr("value");t[d][1]=t[d][1]+1,e[a].status=d,$(".btn-answer").prop("disabled",!0),$("#text-ai-answer").text(""),$("#text-user-answer").val("").focus(),$.ajax({type:"POST",url:"ajax/updatecard.php",data:{word:o,answer:d}}).done((function(r){a++,n()||(s(e[a]),scrollToPageTop())})).fail((function(e,r,a){showMessage("There was an unexpected error updating this word's status","alert-danger")}))})),$(document).on("contextmenu",(function(e){return!1})),$(document).keypress((function(e){if(!$(".btn-answer").prop("disabled"))switch(e.which){case 49:$("#btn-answer-no-recall").click();break;case 50:$("#btn-answer-fuzzy").click();break;case 51:$("#btn-answer-partial").click();break;case 52:$("#btn-answer-excellent").click();break;default:break}}))}));