function normalize(e){return"string"!=typeof e?"":e.replace(/[’‘]/g,"'").replace(/[“”]/g,'"').replace(/…/g,"...").replace(/[–—]/g,"-")}function toggleDictation(){if(""!=$("#audioplayer").find("source").attr("src")){let e=$("#text").clone(),t=e.find(".word"),o=$(".word");0==$(".dict-answer").length?(t.each((function(e,t){let a=$(this);const r=a.text().length,i=o.eq(e).width(),n=o.eq(e).css("font-size");let s="";a.hasClass("learned")?s="var(--w-learned)":a.hasClass("learning")?s="var(--w-learning)":a.hasClass("new")?s="var(--w-new)":a.hasClass("forgotten")&&(s="var(--w-forgotten)"),a.hide().after('<div class="input-group dict-input-group"><input type="text" class="dict" style="width:'+i+"px; line-height:"+n+"; border-color:"+s+';" maxlength="'+r+'" data-text="'+a.text()+'"><span class="dict-answer d-none"></span></div>')})),$("#text").replaceWith(e),scrollToPageTop(),AudioController.playFromBeginning(),$(":text:first").focus()):(t.each((function(){let e=$(this),t=e.next(".dict-input-group").find(".dict");if(t.length>0){let o=t.val(),a=t.attr("data-text"),r=normalize(o.toLowerCase().trim()),i=normalize(a.toLowerCase());""!==r&&r!==i&&e.after('<span class="misspelled-word text-danger fw-bold"> ['+o+"]</span>")}e.show()})),e.find(".dict-input-group").remove(),$("#text").replaceWith(e),TextProcessor.updateAnchorsList(),scrollToPageTop(),AudioController.stop())}}$(document).ready((function(){$("body").on("blur",".dict",(function(){let e=$(this),t=$.trim(e.val().toLowerCase());if(""===t)return e.css("border-color",""),void e.next("span").addClass("d-none");normalize(t)===normalize(e.attr("data-text").toLowerCase())?(e.css("border-color","var(--w-learned)"),e.next("span").addClass("d-none")):e.css("border-color","var(--w-forgotten)")})),$("body").on("keydown",".dict",(function(e){const t=e.keyCode||e.which;if(!e.isComposing&&0!=t&&229!=t&&!$(this).val())if(8==t){const t=$(".dict").index(this)-1;e.preventDefault(),$(".dict").eq(t).focus()}else 32==t&&e.preventDefault()})),$("body").on("input",".dict",(function(e){let t=e.keyCode||e.which;const o=$(this).attr("maxlength"),a=$("#audioplayer")[0].currentTime;switch(0!=t&&229!=t||(t=e.target.value.charAt(e.target.selectionStart-1).charCodeAt()),t){case 8:if(!$(this).val()){const e=$(".dict").index(this)-1;$(".dict").eq(e).focus()}break;case 49:$("#audioplayer")[0].currentTime=a-5;break;case 50:AudioController.togglePlayPause();break;case 51:$("#audioplayer")[0].currentTime=a+5;break;default:break}if($(this).val($(this).val().replace(/\d/gi,"")),o==$(this).val().length&&!e.originalEvent.isComposing){const e=$(".dict").index(this)+1;$(".dict").eq(e).focus()}}))}));