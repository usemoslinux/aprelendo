function normalize(t){return"string"!=typeof t?"":t.replace(/[’‘]/g,"'").replace(/[“”]/g,'"').replace(/…/g,"...").replace(/[–—]/g,"-")}function toggleDictation(){if(""!=$("#audioplayer").find("source").attr("src")){let t=$("#text").clone(),e=t.find(".word"),o=$(".word");0==$(".dict-answer").length?(e.each((function(t,e){let n=$(this);const a=n.text().length,i=o.eq(t).width(),s=o.eq(t).css("font-size");let r="";n.hasClass("learned")?r="var(--w-learned)":n.hasClass("learning")?r="var(--w-learning)":n.hasClass("new")?r="var(--w-new)":n.hasClass("forgotten")&&(r="var(--w-forgotten)"),n.hide().after('<div class="input-group dict-input-group"><input type="text" class="dict" style="width:'+i+"px; line-height:"+s+"; border-color:"+r+';" maxlength="'+a+'" data-text="'+n.text()+'"><span class="dict-answer d-none"></span></div>')})),$("#text").replaceWith(t),scrollToPageTop(),AudioController.playFromBeginning(),$(":text:first").focus()):(e.each((function(){let t=$(this),e=t.next(".dict-input-group").find(".dict");if(e.length>0){let o=e.val(),n=e.attr("data-text"),a=normalize(o.toLowerCase().trim()),i=normalize(n.toLowerCase());""!==a&&a!==i&&t.after('<span class="misspelled-word text-danger fw-bold"> ['+o+"]</span>")}t.show()})),t.find(".dict-input-group").remove(),$("#text").replaceWith(t),TextProcessor.updateAnchorsList(),scrollToPageTop(),AudioController.stop())}}$(document).ready((function(){function t(t){const e=Number(t.attr("maxlength"));if(!e||t.val().length!==e)return;const o=$(".dict").index(t[0])+1;$(".dict").eq(o).focus()}const e=$("#ap-autopause-btn");let o=null,n=!1;function a(){o&&(clearTimeout(o),o=null)}function i(t){e.length&&(t||(n=!1,a()),e.toggleClass("active",t),t?e.removeClass("btn-outline-secondary").addClass("btn-secondary"):e.removeClass("btn-secondary").addClass("btn-outline-secondary"),e.attr("aria-pressed",t?"true":"false"),e.attr("data-autopause",t?"on":"off"),function(t,e){const o=e?"Auto-pause while typing: On":"Auto-pause while typing: Off";t.setAttribute("data-bs-title",o),"function"==typeof setNewTooltip&&"undefined"!=typeof bootstrap&&bootstrap.Tooltip&&"function"==typeof bootstrap.Tooltip.getInstance&&bootstrap.Tooltip.getInstance(t)&&setNewTooltip(t,o)}(e[0],t))}function s(){return e.length&&"on"===e.attr("data-autopause")}e.length&&(i(!0),e.on("click",(function(){i(!e.hasClass("active"))})));const r=$("#ap-play-btn");r.length&&r.on("click",(function(){s()&&(n=!1,a())})),$("body").on("compositionstart",".dict",(function(){$(this).data("isComposing",!0)})),$("body").on("compositionend",".dict",(function(){const e=$(this);e.data("isComposing",!1),document.activeElement===this&&setTimeout((function(){t(e)}),0)})),$("body").on("blur",".dict",(function(){let t=$(this),e=$.trim(t.val().toLowerCase());if(""===e)return t.css("border-color",""),void t.next("span").addClass("d-none");normalize(e)===normalize(t.attr("data-text").toLowerCase())?(t.css("border-color","var(--w-learned)"),t.next("span").addClass("d-none")):t.css("border-color","var(--w-forgotten)")})),$("body").on("keydown",".dict",(function(t){const e=t.keyCode||t.which;if(!t.isComposing&&0!=e&&229!=e&&!$(this).val())if(8==e){const e=$(".dict").index(this)-1;t.preventDefault(),$(".dict").eq(e).focus()}else 32==e&&t.preventDefault()})),$("body").on("input",".dict",(function(e){let i=e.keyCode||e.which;switch(0!=i&&229!=i||(i=e.target.value.charAt(e.target.selectionStart-1).charCodeAt()),i){case 8:if(!$(this).val()){const t=$(".dict").index(this)-1;$(".dict").eq(t).focus()}break;case 49:AudioController.seekRelative(-3);break;case 50:n=!1,a(),AudioController.togglePlayPause();break;case 51:AudioController.seekRelative(3);break;default:break}!function(t){s()&&49!==t&&50!==t&&51!==t&&(AudioController.pause(!0),n=!0)}(i),a(),s()&&n&&(o=setTimeout((function(){s()&&n&&(AudioController.resume(),n=!1)}),1e3)),$(this).val($(this).val().replace(/\d/gi,"")),!0!==$(this).data("isComposing")&&t($(this))}))}));