$(document).ready((function(){let o="",t={s:new URLSearchParams(window.location.search).get("s")||"",o:new URLSearchParams(window.location.search).get("o")||0,p:new URLSearchParams(window.location.search).get("p")||1};async function e(){$("#words-loader").removeClass("d-none"),$("#words-content").addClass("opacity-50");try{const o=new URLSearchParams(t).toString(),e=await fetch(`/ajax/getwords.php?${o}`);if(!e.ok)throw new Error(`HTTP error: ${e.status}`);const a=await e.json();if(!a.success)throw new Error(a.error_msg||"Failed to fetch words");$("#words-content").html(a.payload.html);const r=window.location.pathname+"?"+o;window.history.pushState(t,"",r),"undefined"!=typeof Tooltips&&Tooltips.init(),n()}catch(o){$("#words-content").html(`<div class="alert alert-danger">Error: ${o.message}</div>`)}finally{$("#words-loader").addClass("d-none"),$("#words-content").removeClass("opacity-50")}}function n(){0===$("input.chkbox-selrow:checked").length?$("#actions-menu").addClass("disabled"):$("#actions-menu").removeClass("disabled")}e(),(async()=>{try{const t=await fetch("/ajax/getdicuris.php");if(!t.ok)throw new Error(`HTTP error: ${t.status}`);const e=await t.json();e.success&&(o=e.payload.dictionary_uri)}catch(o){}})(),$("#words-filter-form").on("submit",(function(o){o.preventDefault(),t.s=$("#s").val().trim(),t.p=1,e()})),$(document).on("click","#dropdown-menu-sort .o",(function(o){o.preventDefault(),t.o=$(this).data("value")||0,t.p=1,e()})),$(document).on("click",".pagination a",(function(o){o.preventDefault();const n=new URL($(this).attr("href"),window.location.origin);t.p=n.searchParams.get("p")||1,e()})),$(document).on("click","#mDelete",(async function(){if(confirm("Really delete?")){let o=[];if($("input.chkbox-selrow:checked").each((function(){o.push($(this).attr("data-idWord"))})),0===o.length)return;try{const t=new URLSearchParams;t.append("wordIDs",JSON.stringify(o));const n=await fetch("/ajax/removeword.php",{method:"POST",body:t});if(!n.ok)throw new Error(`HTTP error: ${n.status}`);const a=await n.json();if(!a.success)throw new Error(a.error_msg||"Failed to delete words");e()}catch(o){alert(`Oops! ${o.message}`)}}})),$(document).on("change",".chkbox-selrow",n),$(document).on("click","#chkbox-selall",(function(o){const t=$(this).prop("checked");$(".chkbox-selrow").prop("checked",t),n()})),$(document).on("click",".word",(function(t){if(!o)return;const e=LinkBuilder.forWordInDictionary(o,$(this).text());openInNewTab(e)})),window.onpopstate=function(o){o.state&&(t=o.state,$("#s").val(t.s),e())}}));