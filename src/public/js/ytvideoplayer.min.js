const tag=document.createElement("script"),video_element=document.getElementById("videoplayer"),ytId=video_element.dataset.ytid;tag.src="https://www.youtube.com/iframe_api";const first_script_tag=document.getElementsByTagName("script")[0];first_script_tag.parentNode.insertBefore(tag,first_script_tag);let VideoController={};const youtubeApiReady=new Promise((e=>{window.onYouTubeIframeAPIReady=function(){e()}}));function initializeVideoPlayer(e){Promise.all([youtubeApiReady]).then((([])=>{VideoController.instance=new YT.Player("videoplayer",{playerVars:{autoplay:0,start:Math.round(e),loop:0,controls:2,fs:0,showinfo:0,autohide:1,modestbranding:1,playsinline:1},videoId:ytId,events:{onStateChange:onPlayerStateChange}}),VideoController.resume_video=!1,VideoController.timer_id=null,VideoController.start_time=null,VideoController.play=function(){VideoController.instance.playVideo(),VideoController.resume_video=!1},VideoController.pause=function(e){VideoController.isPaused()||(VideoController.instance.pauseVideo(),VideoController.resume_video=e)},VideoController.isPaused=function(){return VideoController.instance.getPlayerState()!==YT.PlayerState.PLAYING},VideoController.resume=function(){VideoController.resume_video&&(VideoController.play(),VideoController.resume_video=!1)},VideoController.getCurrentTime=function(){return VideoController.instance.getCurrentTime()}})).catch((e=>{}))}function centerInContainer(e,t){if(!e||!t)return;const n=e.getBoundingClientRect(),o=t.getBoundingClientRect(),r=t.scrollTop,i=n.top+n.height/2-(o.top+o.height/2);t.scrollTop=r+i}function getOffsetTopWithin(e,t){let n=0,o=e;for(;o&&o!==t;)n+=o.offsetTop,o=o.offsetParent;return n}function getSpans(){return Array.from(document.querySelectorAll("#text-container span"))}function findCurrentIndex(e,t){let n=0,o=e.length-1,r=-1;for(;n<=o;){const i=n+o>>1;parseFloat(e[i].dataset.start||"0")<=t?(r=i,n=i+1):o=i-1}return r}let rafId=null,lastIdx=-1;function startTicker(e){rafId&&cancelAnimationFrame(rafId);const t=getSpans();if(!t.length)return;const n=document.getElementById("text-container");rafId=requestAnimationFrame((function o(){if(!e||e.isPaused())return void(rafId=null);const r=e.getCurrentTime(),i=findCurrentIndex(t,r);-1!==i&&i!==lastIdx&&(lastIdx>=0&&t[lastIdx]&&t[lastIdx].classList.remove("video-reading-line"),t[i].classList.add("video-reading-line"),centerInContainer(t[i],n),lastIdx=i),rafId=requestAnimationFrame(o)}))}function stopTicker(){rafId&&cancelAnimationFrame(rafId),rafId=null}function onPlayerStateChange(e){const t=e.data;if(t===YT.PlayerState.PLAYING)startTicker(VideoController);else if(t===YT.PlayerState.ENDED){stopTicker();getSpans().forEach((e=>e.classList.remove("video-reading-line"))),lastIdx=-1}else stopTicker()}