const TextUnderliner=(()=>{const e=["zh","ja","ko"],t={0:"learned",1:"learning",2:"new",3:"forgotten"};return{apply:function(n,r,s){let o=n.text,i=[],a="",c=[],l="";return n.user_words.forEach((e=>{e.is_phrase>0?(i.push(e),a+=e.word.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")+"|"):(c.push(e),l+=e.word+"|")})),a=a.slice(0,-1),l=l.slice(0,-1),o=function(n,r,s,o,i){let a="";const c=s?" style='display: none;'":"";return o.length>0&&(a=e.includes(r)?new RegExp("(?:<[^>]*>)|("+i+")","iug"):new RegExp("(?:<[^>]*>)|(?<![\\p{L}])("+i+")(?![\\p{L}])","iug"),n=n.replace(a,(function(e,n){if(void 0===n)return e;const r=o.find((t=>t.word.toLowerCase()===e.toLowerCase()));return"<a class='word reviewing "+t[r.status]+"' "+c+">"+n+"</a>"}))),n}(o,r,s,i,a),o=function(n,r,s,o,i){let a="";const c=s?" style='display: none;'":"";return o.length>0&&(a=e.includes(r)?new RegExp("(?:s*<a class='word[^>]+>.*?</a>|<[^>]*>)|("+i+")","iug"):new RegExp("(?:s*<a class='word[^>]+>.*?</a>|<[^>]*>)|(?<![\\p{L}])("+i+")(?![\\p{L}])","iug"),n=n.replace(a,(function(e,n){if(void 0===n)return e;const r=o.find((t=>t.word.toLowerCase()===e.toLowerCase()));return"<a class='word reviewing "+t[r.status]+"' "+c+">"+n+"</a>"}))),n}(o,r,s,c,l),n.high_freq&&(o=function(t,n,r,s){let o="";const i=r?"style='display: none;'":"";return s=s.join("|"),o=e.includes(n)?new RegExp("(?:s*<a class='word[^>]+>.*?</a>|<[^>]*>)|("+s+")","iug"):new RegExp("(?:s*<a class='word[^>]+>.*?</a>|<[^>]*>)|(?<![\\p{L}])("+s+")(?![\\p{L}])","iug"),t=t.replace(o,(function(e,t,n,r){return void 0===t?e:"<a class='word frequency-list' "+i+">"+t+"</a>"}))}(o,r,s,n.high_freq)),function(t,n,r){const s=r?'style="display: none;"':"",o=e.includes(n)?/(?:\s*<a class='word[^>]+>.*?<\/a>|<[^>]*>)|(\p{L})/giu:/(?:\s*<a class='word[^>]+>.*?<\/a>|<[^>]*>)|(\p{L}+)/giu;let i=t.replace(o,((e,t)=>void 0!==t?`<a class="word" ${s}>${t}</a>`:e));return i=i.replace(/(?<=<[^>]*>)([^\p{L}<]+)/gu,(e=>`<a>${e}</a>`)),i}(o,r,s)}}})(),TextProcessor=(()=>{const e=["zh","ja","ko"];let t;function n(){return $(parent.document).find("#text")}return{getTextContainer:n,updateAnchorsList:function(){t=n().find("a")},getAnchorsList:()=>t,getAnchorIndex:function(e){return t.index(e)},langHasNoWordSeparators:function(t){return e.includes(t)}}})(),TextHighlighter={removeAll:function(){TextProcessor.getAnchorsList().filter(".highlighted").removeClass("highlighted")},addSelection:function(e,t){const n=Math.min(e,t),r=Math.max(e,t);if(TextProcessor.getAnchorsList().eq(e).parent()[0]===TextProcessor.getAnchorsList().eq(t).parent()[0])for(let e=n;e<=r;e++)TextProcessor.getAnchorsList().eq(e).addClass("highlighted")},getSelection:function(e,t){const n=Math.min(e,t),r=Math.max(e,t);let s=[];for(let e=n;e<=r;e++)s.push(TextProcessor.getAnchorsList().eq(e)[0]);return $(s)}};