const langs_with_no_word_separator=["zh","ja","ko"],vocab_status={0:"learned",1:"learning",2:"new",3:"forgotten"};function addLinks(e,n,r){let s="",t="";const a=r?"style='display: none;'":"";return s=langs_with_no_word_separator.includes(n)?new RegExp(/(?:\s*<a class='word[^>]+>.*?<\/a>|<[^>]*>)|(\p{L})/giu):new RegExp(/(?:\s*<a class='word[^>]+>.*?<\/a>|<[^>]*>)|(\p{L}+)/giu),t=e.replace(s,(function(e,n){return void 0===n?e:'<a class="word" '+a+">"+n+"</a>"})),s=new RegExp(/(?<=<[^>]*>)([^\p{L}<]+)/gu),t=t.replace(s,(function(e,n){return void 0===n?e:"<a>"+n+"</a>"})),t}function underlineWords(e,n,r){let s=e.text,t=[],a="",o=[],i="";return e.user_words.forEach((e=>{e.is_phrase>0?(t.push(e),a+=escapeRegExp(e.word)+"|"):(o.push(e),i+=e.word+"|")})),a=a.slice(0,-1),i=i.slice(0,-1),s=underlineUserPhrases(s,n,r,t,a),s=underlineUserWords(s,n,r,o,i),e.high_freq&&(s=underlineFrequentWords(s,n,r,e.high_freq)),addLinks(s,n,r)}function underlineUserWords(e,n,r,s,t){let a="";const o=r?" style='display: none;'":"";return s.length>0&&(a=langs_with_no_word_separator.includes(n)?new RegExp("(?:s*<a class='word[^>]+>.*?</a>|<[^>]*>)|("+t+")","iug"):new RegExp("(?:s*<a class='word[^>]+>.*?</a>|<[^>]*>)|(?<![\\p{L}])("+t+")(?![\\p{L}])","iug"),e=e.replace(a,(function(e,n){if(void 0===n)return e;const r=s.find((n=>n.word.toLowerCase()===e.toLowerCase()));return"<a class='word reviewing "+vocab_status[r.status]+"' "+o+">"+n+"</a>"}))),e}function underlineUserPhrases(e,n,r,s,t){let a="";const o=r?" style='display: none;'":"";return s.length>0&&(a=langs_with_no_word_separator.includes(n)?new RegExp("(?:<[^>]*>)|("+t+")","iug"):new RegExp("(?:<[^>]*>)|(?<![\\p{L}])("+t+")(?![\\p{L}])","iug"),e=e.replace(a,(function(e,n){if(void 0===n)return e;const r=s.find((n=>n.word.toLowerCase()===e.toLowerCase()));return"<a class='word reviewing "+vocab_status[r.status]+"' "+o+">"+n+"</a>"}))),e}function underlineFrequentWords(e,n,r,s){let t="";const a=r?"style='display: none;'":"";return s=s.join("|"),t=langs_with_no_word_separator.includes(n)?new RegExp("(?:s*<a class='word[^>]+>.*?</a>|<[^>]*>)|("+s+")","iug"):new RegExp("(?:s*<a class='word[^>]+>.*?</a>|<[^>]*>)|(?<![\\p{L}])("+s+")(?![\\p{L}])","iug"),e=e.replace(t,(function(e,n,r,s){return void 0===n?e:"<a class='word frequency-list' "+a+">"+n+"</a>"}))}function escapeRegExp(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function getUniqueElements(e){let n=new Set;return $(e).each((function(){let e=$(this).text().toLowerCase().trim();n.add(e)})),n.size}