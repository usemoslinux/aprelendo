const langs_with_no_word_separator=["zh","ja","ko"],vocab_status={0:"learned",1:"learning",2:"new",3:"forgotten"};function addLinks(e,n,a){let t="",r="";const s=a?"style='display: none;'":"";return t=langs_with_no_word_separator.includes(n)?new RegExp(/(?:\s*<a class='word[^>]+>.*?<\/a>|<[^>]*>)|(\p{L})/giu):new RegExp(/(?:\s*<a class='word[^>]+>.*?<\/a>|<[^>]*>)|(\p{L}+)/giu),r=e.replace(t,(function(e,n){return void 0===n?e:'<a class="word" data-toggle="modal" data-bs-target="#dic-modal" '+s+">"+n+"</a>"})),t=new RegExp(/(?<=<[^>]*>)([^\p{L}<]+)/gu),r=r.replace(t,(function(e,n){return void 0===n?e:"<a>"+n+"</a>"})),r}function underlineWords(e,n,a){let t=e.text,r=[],s="",o=[],d="";return e.user_words.forEach((e=>{e.is_phrase>0?(r.push(e),s+=escapeRegExp(e.word)+"|"):(o.push(e),d+=e.word+"|")})),s=s.slice(0,-1),d=d.slice(0,-1),t=underlineUserPhrases(t,n,a,r,s),t=underlineUserWords(t,n,a,o,d),e.high_freq&&(t=underlineFrequentWords(t,n,a,e.high_freq)),addLinks(t,n,a)}function underlineUserWords(e,n,a,t,r){let s="";const o=a?" style='display: none;'":"";return t.length>0&&(s=langs_with_no_word_separator.includes(n)?new RegExp("(?:s*<a class='word[^>]+>.*?</a>|<[^>]*>)|("+r+")","iug"):new RegExp("(?:s*<a class='word[^>]+>.*?</a>|<[^>]*>)|(?<![\\p{L}])("+r+")(?![\\p{L}])","iug"),e=e.replace(s,(function(e,n){if(void 0===n)return e;const a=t.find((n=>n.word.toLowerCase()===e.toLowerCase()));return"<a class='word reviewing "+vocab_status[a.status]+"' data-toggle='modal' data-bs-target='#dic-modal'"+o+">"+n+"</a>"}))),e}function underlineUserPhrases(e,n,a,t,r){let s="";const o=a?" style='display: none;'":"";return t.length>0&&(s=langs_with_no_word_separator.includes(n)?new RegExp("(?:<[^>]*>)|("+r+")","iug"):new RegExp("(?:<[^>]*>)|(?<![\\p{L}])("+r+")(?![\\p{L}])","iug"),e=e.replace(s,(function(e,n){if(void 0===n)return e;const a=t.find((n=>n.word.toLowerCase()===e.toLowerCase()));return"<a class='word reviewing "+vocab_status[a.status]+"' data-toggle='modal' data-bs-target='#dic-modal'"+o+">"+n+"</a>"}))),e}function underlineFrequentWords(e,n,a,t){let r="";const s=a?"style='display: none;'":"";return t=t.join("|"),r=langs_with_no_word_separator.includes(n)?new RegExp("(?:s*<a class='word[^>]+>.*?</a>|<[^>]*>)|("+t+")","iug"):new RegExp("(?:s*<a class='word[^>]+>.*?</a>|<[^>]*>)|(?<![\\p{L}])("+t+")(?![\\p{L}])","iug"),e=e.replace(r,(function(e,n,a,t){return void 0===n?e:"<a class='word frequency-list' data-toggle='modal' data-bs-target='#dic-modal' "+s+">"+n+"</a>"}))}function escapeRegExp(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function getUniqueElements(e){let n=new Set;return $(e).each((function(){let e=$(this).text().toLowerCase().trim();n.add(e)})),n.size}