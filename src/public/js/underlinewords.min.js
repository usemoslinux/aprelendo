const TextUnderliner=(()=>{const e=["zh","ja","ko"],t={0:"learned",1:"learning",2:"new",3:"forgotten"};return{apply:function(n,r){let s=n.text,o=[],i="",a=[],c="";return n.user_words.forEach((e=>{e.is_phrase>0?(o.push(e),i+=e.word.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")+"|"):(a.push(e),c+=e.word+"|")})),i=i.slice(0,-1),c=c.slice(0,-1),s=function(n,r,s,o){let i="";return s.length>0&&(i=e.includes(r)?new RegExp("(?:<[^>]*>)|("+o+")","iug"):new RegExp("(?:<[^>]*>)|(?<![\\p{L}])("+o+")(?![\\p{L}])","iug"),n=n.replace(i,(function(e,n){if(void 0===n)return e;const r=s.find((t=>t.word.toLowerCase()===e.toLowerCase()));return`<a class="word reviewing ${t[r.status]}">${n}</a>`}))),n}(s,r,o,i),s=function(n,r,s,o){let i="";return s.length>0&&(i=e.includes(r)?new RegExp("(?:s*<a class='word[^>]+>.*?</a>|<[^>]*>)|("+o+")","iug"):new RegExp("(?:s*<a class='word[^>]+>.*?</a>|<[^>]*>)|(?<![\\p{L}])("+o+")(?![\\p{L}])","iug"),n=n.replace(i,(function(e,n){if(void 0===n)return e;const r=s.find((t=>t.word.toLowerCase()===e.toLowerCase()));return`<a class="word reviewing ${t[r.status]}">${n}</a>`}))),n}(s,r,a,c),n.high_freq&&(s=function(t,n,r){let s="";return r=r.join("|"),s=e.includes(n)?new RegExp("(?:s*<a class='word[^>]+>.*?</a>|<[^>]*>)|("+r+")","iug"):new RegExp("(?:s*<a class='word[^>]+>.*?</a>|<[^>]*>)|(?<![\\p{L}])("+r+")(?![\\p{L}])","iug"),t=t.replace(s,(function(e,t,n,r){return void 0===t?e:`<a class="word frequency-list">${t}</a>`}))}(s,r,n.high_freq)),function(t,n){const r=e.includes(n)?/(?:\s*<a class="word[^>]+>.*?<\/a>|<[^>]*>)|(\p{L})/giu:/(?:\s*<a class="word[^>]+>.*?<\/a>|<[^>]*>)|(\p{L}+)/giu;let s=t.replace(r,((e,t)=>void 0!==t?`<a class="word">${t}</a>`:e));return s=s.replace(/(?<=<[^>]*>)([^\p{L}<]+)/gu,(e=>`<a>${e}</a>`)),s}(s,r)}}})(),TextProcessor=(()=>{const e=["zh","ja","ko"];let t;function n(){return $(parent.document).find("#text")}return{getTextContainer:n,updateAnchorsList:function(){t=n().find("a")},getAnchorsList:()=>t,getAnchorIndex:function(e){return t.index(e)},langHasNoWordSeparators:function(t){return e.includes(t)}}})(),TextHighlighter={removeAll:function(){TextProcessor.getAnchorsList().filter(".highlighted").removeClass("highlighted")},addSelection:function(e,t){const n=Math.min(e,t),r=Math.max(e,t);if(TextProcessor.getAnchorsList().eq(e).parent()[0]===TextProcessor.getAnchorsList().eq(t).parent()[0])for(let e=n;e<=r;e++)TextProcessor.getAnchorsList().eq(e).addClass("highlighted")},getSelection:function(e,t){const n=Math.min(e,t),r=Math.max(e,t);let s=[];for(let e=n;e<=r;e++)s.push(TextProcessor.getAnchorsList().eq(e)[0]);return $(s)}};