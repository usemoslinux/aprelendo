const TextUnderliner=(()=>{const e=["zh","ja","ko"],t={0:"learned",1:"learning",2:"new",3:"forgotten"};function n(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}return{apply:function(r,o){let s=r.text,i=[],a="",c=[],u="";return r.user_words.forEach((e=>{e.is_phrase>0?(i.push(e),a+=n(e.word)+"|"):(c.push(e),u+=e.word+"|")})),a=a.slice(0,-1),u=u.slice(0,-1),s=function(n,r,o,s){let i="";if(o.length>0){const a=new Map;o.forEach((function(e){const t=e.word.toLowerCase();a.has(t)||a.set(t,e.status)})),i=e.includes(r)?new RegExp("(?:<[^>]*>)|("+s+")","iug"):new RegExp("(?:<[^>]*>)|(?<![\\p{L}])("+s+")(?![\\p{L}])","iug"),n=n.replace(i,(function(e,n){if(void 0===n)return e;const r=a.get(n.toLowerCase()),o=t[r];return void 0===o?e:`<a class="word reviewing ${o}">${n}</a>`}))}return n}(s,o,i,a),s=function(n,r,o,s){let i="";if(o.length>0){const a=new Map;o.forEach((function(e){const t=e.word.toLowerCase();a.has(t)||a.set(t,e.status)})),i=e.includes(r)?new RegExp("(?:s*<a class='word[^>]+>.*?</a>|<[^>]*>)|("+s+")","iug"):new RegExp("(?:s*<a class='word[^>]+>.*?</a>|<[^>]*>)|(?<![\\p{L}])("+s+")(?![\\p{L}])","iug"),n=n.replace(i,(function(e,n){if(void 0===n)return e;const r=a.get(n.toLowerCase()),o=t[r];return void 0===o?e:`<a class="word reviewing ${o}">${n}</a>`}))}return n}(s,o,c,u),r.high_freq&&(s=function(t,r,o){let s="";if(0===o.length)return t;const i=e.includes(r),a=new Set(o.map((function(e){return e.toLowerCase()}))),c=o.map((function(e){return n(e)})).join("|"),u=/\bclass\s*=\s*(['"])([^'"]*)\1/iu;return t=t.replace(/<a\b([^>]*)>([^<]*)<\/a>/giu,(function(e,t,n){const r=t.match(u);if(!r)return e;const o=r[2],s=o.trim().split(/\s+/u),i=s.includes("reviewing"),c=s.includes("word"),l=a.has(n.toLowerCase());if(!c||i||!l)return e;if(s.includes("frequency-list"))return e;const f=`${o} frequency-list`;return`<a${t.replace(u,`class=${r[1]}${f}${r[1]}`)}>${n}</a>`})),s=i?new RegExp("(?:<a\\b[^>]*>[^<]*<\\/a>|<[^>]*>)|("+c+")","iug"):/(?:<a\b[^>]*>[^<]*<\/a>|<[^>]*>)|(\p{L}+)/giu,t=t.replace(s,(function(e,t){return void 0===t?e:a.has(t.toLowerCase())?`<a class="word frequency-list">${t}</a>`:e}))}(s,o,r.high_freq)),function(t,n){const r=e.includes(n)?/(?:\s*<a class="word[^>]+>.*?<\/a>|<[^>]*>)|(\p{L})/giu:/(?:\s*<a class="word[^>]+>.*?<\/a>|<[^>]*>)|(\p{L}+)/giu;let o=t.replace(r,((e,t)=>void 0!==t?`<a class="word">${t}</a>`:e));return o=o.replace(/(?<=<[^>]*>)([^\p{L}<]+)/gu,(e=>`<a>${e}</a>`)),o}(s,o)}}})(),TextProcessor=(()=>{const e=["zh","ja","ko"];let t=$();function n(){return $(parent.document).find("#text")}function r(){return t=n().find("a"),t}function o(){return t&&"function"==typeof t.filter?t:r()}return{getTextContainer:n,updateAnchorsList:r,getAnchorsList:o,getAnchorIndex:function(e){return o().index(e)},langHasNoWordSeparators:function(t){return e.includes(t)}}})(),TextHighlighter={removeAll:function(){const e=TextProcessor.getAnchorsList();e&&0!==e.length&&e.filter(".highlighted").removeClass("highlighted")},addSelection:function(e,t){const n=TextProcessor.getAnchorsList();if(!n||0===n.length)return;const r=Math.min(e,t),o=Math.max(e,t),s=n.eq(e),i=n.eq(t),a=s.parent()[0],c=i.parent()[0];if(a&&c&&a===c)for(let e=r;e<=o;e++)n.eq(e).addClass("highlighted")},getSelection:function(e,t){const n=TextProcessor.getAnchorsList(),r=[];if(!n||0===n.length)return $(r);const o=Math.min(e,t),s=Math.max(e,t);for(let e=o;e<=s;e++){const t=n.eq(e)[0];t&&r.push(t)}return $(r)}};