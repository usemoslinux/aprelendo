const TextUnderliner=(()=>{const e=["zh","ja","ko"],t={0:"learned",1:"learning",2:"new",3:"forgotten"};function n(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}return{apply:function(r,s){let o=r.text,i=[],a="",c=[],u="";return r.user_words.forEach((e=>{e.is_phrase>0?(i.push(e),a+=n(e.word)+"|"):(c.push(e),u+=e.word+"|")})),a=a.slice(0,-1),u=u.slice(0,-1),o=function(n,r,s,o){let i="";if(s.length>0){const a=new Map;s.forEach((function(e){const t=e.word.toLowerCase();a.has(t)||a.set(t,e.status)})),i=e.includes(r)?new RegExp("(?:<[^>]*>)|("+o+")","iug"):new RegExp("(?:<[^>]*>)|(?<![\\p{L}])("+o+")(?![\\p{L}])","iug"),n=n.replace(i,(function(e,n){if(void 0===n)return e;const r=a.get(n.toLowerCase()),s=t[r];return void 0===s?e:`<a class="word reviewing ${s}">${n}</a>`}))}return n}(o,s,i,a),o=function(n,r,s,o){let i="";if(s.length>0){const a=new Map;s.forEach((function(e){const t=e.word.toLowerCase();a.has(t)||a.set(t,e.status)})),i=e.includes(r)?new RegExp("(?:s*<a class='word[^>]+>.*?</a>|<[^>]*>)|("+o+")","iug"):new RegExp("(?:s*<a class='word[^>]+>.*?</a>|<[^>]*>)|(?<![\\p{L}])("+o+")(?![\\p{L}])","iug"),n=n.replace(i,(function(e,n){if(void 0===n)return e;const r=a.get(n.toLowerCase()),s=t[r];return void 0===s?e:`<a class="word reviewing ${s}">${n}</a>`}))}return n}(o,s,c,u),r.high_freq&&(o=function(t,r,s){let o="";if(0===s.length)return t;const i=e.includes(r),a=new Set(s.map((function(e){return e.toLowerCase()}))),c=s.map((function(e){return n(e)})).join("|"),u=/\bclass\s*=\s*(['"])([^'"]*)\1/iu;return t=t.replace(/<a\b([^>]*)>([^<]*)<\/a>/giu,(function(e,t,n){const r=t.match(u);if(!r)return e;const s=r[2],o=s.trim().split(/\s+/u),i=o.includes("reviewing"),c=o.includes("word"),l=a.has(n.toLowerCase());if(!c||i||!l)return e;if(o.includes("frequency-list"))return e;const g=`${s} frequency-list`;return`<a${t.replace(u,`class=${r[1]}${g}${r[1]}`)}>${n}</a>`})),o=i?new RegExp("(?:<a\\b[^>]*>[^<]*<\\/a>|<[^>]*>)|("+c+")","iug"):/(?:<a\b[^>]*>[^<]*<\/a>|<[^>]*>)|(\p{L}+)/giu,t=t.replace(o,(function(e,t){return void 0===t?e:a.has(t.toLowerCase())?`<a class="word frequency-list">${t}</a>`:e}))}(o,s,r.high_freq)),function(t,n){const r=e.includes(n)?/(?:\s*<a class="word[^>]+>.*?<\/a>|<[^>]*>)|(\p{L})/giu:/(?:\s*<a class="word[^>]+>.*?<\/a>|<[^>]*>)|(\p{L}+)/giu;let s=t.replace(r,((e,t)=>void 0!==t?`<a class="word">${t}</a>`:e));return s=s.replace(/(?<=<[^>]*>)([^\p{L}<]+)/gu,(e=>`<a>${e}</a>`)),s}(o,s)}}})(),TextProcessor=(()=>{const e=["zh","ja","ko"];let t;function n(){return $(parent.document).find("#text")}return{getTextContainer:n,updateAnchorsList:function(){t=n().find("a")},getAnchorsList:()=>t,getAnchorIndex:function(e){return t.index(e)},langHasNoWordSeparators:function(t){return e.includes(t)}}})(),TextHighlighter={removeAll:function(){TextProcessor.getAnchorsList().filter(".highlighted").removeClass("highlighted")},addSelection:function(e,t){const n=Math.min(e,t),r=Math.max(e,t);if(TextProcessor.getAnchorsList().eq(e).parent()[0]===TextProcessor.getAnchorsList().eq(t).parent()[0])for(let e=n;e<=r;e++)TextProcessor.getAnchorsList().eq(e).addClass("highlighted")},getSelection:function(e,t){const n=Math.min(e,t),r=Math.max(e,t);let s=[];for(let e=n;e<=r;e++)s.push(TextProcessor.getAnchorsList().eq(e)[0]);return $(s)}};