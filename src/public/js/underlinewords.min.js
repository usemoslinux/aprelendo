const TextUnderliner=(()=>{const e=["zh","ja","ko"],t={0:"learned",1:"learning",2:"new",3:"forgotten"};return{apply:function(n,r){let s=n.text,o=[],i="",c=[],a="";return n.user_words.forEach((e=>{e.is_phrase>0?(o.push(e),i+=e.word.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")+"|"):(c.push(e),a+=e.word+"|")})),i=i.slice(0,-1),a=a.slice(0,-1),s=function(n,r,s,o){let i="";if(s.length>0){const c=new Map;s.forEach((function(e){const t=e.word.toLowerCase();c.has(t)||c.set(t,e.status)})),i=e.includes(r)?new RegExp("(?:<[^>]*>)|("+o+")","iug"):new RegExp("(?:<[^>]*>)|(?<![\\p{L}])("+o+")(?![\\p{L}])","iug"),n=n.replace(i,(function(e,n){if(void 0===n)return e;const r=c.get(n.toLowerCase()),s=t[r];return void 0===s?e:`<a class="word reviewing ${s}">${n}</a>`}))}return n}(s,r,o,i),s=function(n,r,s,o){let i="";if(s.length>0){const c=new Map;s.forEach((function(e){const t=e.word.toLowerCase();c.has(t)||c.set(t,e.status)})),i=e.includes(r)?new RegExp("(?:s*<a class='word[^>]+>.*?</a>|<[^>]*>)|("+o+")","iug"):new RegExp("(?:s*<a class='word[^>]+>.*?</a>|<[^>]*>)|(?<![\\p{L}])("+o+")(?![\\p{L}])","iug"),n=n.replace(i,(function(e,n){if(void 0===n)return e;const r=c.get(n.toLowerCase()),s=t[r];return void 0===s?e:`<a class="word reviewing ${s}">${n}</a>`}))}return n}(s,r,c,a),n.high_freq&&(s=function(t,n,r){let s="";const o=r.join("|"),i=e.includes(n),c=new RegExp("^(?:"+o+")$","iu"),a=/\bclass\s*=\s*(['"])([^'"]*)\1/iu;return t=t.replace(/<a\b([^>]*)>([^<]*)<\/a>/giu,(function(e,t,n){const r=t.match(a);if(!r)return e;const s=r[2],o=s.trim().split(/\s+/u),i=o.includes("reviewing");if(!o.includes("word")||i||!c.test(n))return e;if(o.includes("frequency-list"))return e;const u=`${s} frequency-list`;return`<a${t.replace(a,`class=${r[1]}${u}${r[1]}`)}>${n}</a>`})),s=i?new RegExp("(?:<a\\b[^>]*>[^<]*<\\/a>|<[^>]*>)|("+o+")","iug"):new RegExp("(?:<a\\b[^>]*>[^<]*<\\/a>|<[^>]*>)|(?<![\\p{L}])("+o+")(?![\\p{L}])","iug"),t=t.replace(s,(function(e,t){return void 0===t?e:`<a class="word frequency-list">${t}</a>`}))}(s,r,n.high_freq)),function(t,n){const r=e.includes(n)?/(?:\s*<a class="word[^>]+>.*?<\/a>|<[^>]*>)|(\p{L})/giu:/(?:\s*<a class="word[^>]+>.*?<\/a>|<[^>]*>)|(\p{L}+)/giu;let s=t.replace(r,((e,t)=>void 0!==t?`<a class="word">${t}</a>`:e));return s=s.replace(/(?<=<[^>]*>)([^\p{L}<]+)/gu,(e=>`<a>${e}</a>`)),s}(s,r)}}})(),TextProcessor=(()=>{const e=["zh","ja","ko"];let t;function n(){return $(parent.document).find("#text")}return{getTextContainer:n,updateAnchorsList:function(){t=n().find("a")},getAnchorsList:()=>t,getAnchorIndex:function(e){return t.index(e)},langHasNoWordSeparators:function(t){return e.includes(t)}}})(),TextHighlighter={removeAll:function(){TextProcessor.getAnchorsList().filter(".highlighted").removeClass("highlighted")},addSelection:function(e,t){const n=Math.min(e,t),r=Math.max(e,t);if(TextProcessor.getAnchorsList().eq(e).parent()[0]===TextProcessor.getAnchorsList().eq(t).parent()[0])for(let e=n;e<=r;e++)TextProcessor.getAnchorsList().eq(e).addClass("highlighted")},getSelection:function(e,t){const n=Math.min(e,t),r=Math.max(e,t);let s=[];for(let e=n;e<=r;e++)s.push(TextProcessor.getAnchorsList().eq(e)[0]);return $(s)}};