const Dictionaries=(()=>{let e={dictionary:"",img_dictionary:"",translator:""};return{fetchURIs:async()=>{try{const t=await fetch("/ajax/getdicuris.php");if(!t.ok)throw new Error(`HTTP error: ${t.status}`);const n=await t.json();if(!n.success)throw new Error(n.error_msg||"Failed to fetch dictionary URIs");e.dictionary=n.payload.dictionary_uri,e.img_dictionary=n.payload.img_dictionary_uri,e.translator=n.payload.translator_uri}catch(e){alert(`Oops! ${e.message}`)}},getWordFrequency:e=>100==e?"Medium/low":e<81?"Very high":e<97?"High":void 0,getURIs:()=>e}})(),SentenceExtractor=(()=>{const e={universal:["etc.","et al.","Mr.","Ms.","Mrs.","Dr.","Prof."],ar:[],bg:["т.е.","и т.н.","и др."],ca:["p. ex.","p. s."],zh:[],hr:["npr.","itd.","dr.","str."],cs:["tj.","atd.","č. p.","str."],da:["dvs.","osv."],nl:["d.w.z.","enz."],en:["Rev.","St.","No.","Jr.","Sr.","Ph.D."],fr:["M.","Mme.","Mlle.","p. ex.","p. j."],de:["z.B.","u.a.","d.h.","usw.","Nr."],el:["π.χ.","κ.λπ."],he:["וכו.",'ד"ר.'],hi:["डॉ.","श्री."],hu:["pl.","stb.","u.ö."],it:["Sig.","Sig.ra","ecc.","p.es.","dott."],ja:[],ko:[],no:["dvs.","osv."],pl:["np.","itp.","dr."],pt:["Sr.","Sra.","Dra.","p. ex."],ro:["d-l.","d-na.","ș.a.m.d."],ru:["т.е.","и т.д.","с. (стр.)"],sk:["tzn.","atď."],sl:["npr.","ipd."],es:["Sr.","Sra.","Dra.","p. ej."],sv:["t.ex.","dvs.","osv."],tr:["örn.","vb."],vi:["v.v.","Tp."]};let t;function n(e,t,n){let o=t,r=0,s=$(e[o]).text().length;for(;1===s;){"."===$(e[o+n]).text().trim()?(r+=2,o+=2*n):o+=n,s=$(e[o+n]).text().length}return r}function o(e,n,o){const r=1===o?$(e[n]).text():$(e[n-2]).text();return t.some((e=>r===e))}function r(e,t){const n=[...t.single.open,...t.double.open],o=[...t.single.close,...t.double.close];n.includes(e[e.length-1])&&(e=e.slice(0,-1));const r=function(e,t,n){for(let o=0;o<t.length;o++)if(t[o]===n[o]){const n=new RegExp(t[o]+"(?=$|\\W)","gu");if((e.match(n)||[]).length%2!=0)return t[o]}for(let o=0;o<t.length;o++)if(t[o]!==n[o]){const r=new RegExp(t[o]+"(?=$|\\W)","gu");let s=e.split(r).length-1;const l=new RegExp(n[o]+"(?=$|\\W)","gu");if(e.split(l).length-1>s){let r=0;for(const s of e)if(s===t[o])r++;else if(s===n[o]){if(!(r>0))return t[o];r--}}}return""}(e,n,o);return r&&(e=r+e),e}return{extractSentence:function(s,l=!1){let c=/[.!?\u3002\uFF01\uFF1F](?=\s|$)/;const i=TextProcessor.getAnchorsList(),a=/[\r\n]/;if(!i||0===i.length)return"";const p=TextProcessor.getAnchorIndex(s);if(p<0||p>=i.length)return"";const u=$("#text").data("text-lang");!function(n){if(t=[],e.universal){const n=e.universal.map((e=>{const t=RegExp(/(\w+)\W*$/u).exec(e);return t?t[1]:e}));t.push(...n)}if(e[n]){const o=e[n].map((e=>{const t=RegExp(/(\w+)\W*$/u).exec(e);return t?t[1]:e}));t.push(...o)}}(u);let d=p;for(;d>0;){const e=$(i[d-1]).text();if(l&&a.test(e))break;if(c.test(e)){const e=n(i,d-2,-1);if(e)d-=e+2;else{if(!o(i,d,-1))break}}d--}let g=p;for(;g<i.length-1;){const e=$(i[g+1]).text();if(l&&a.test(e))break;if(c.test(e)){const e=n(i,g,1);if(e)g+=e;else{if(!o(i,g,1)){g++;break}}}g++}c=/[.!?\u3002\uFF01\uFF1F]/;let f=function(e,t,n,o,r,s=!1){let l="";const c=/[\r\n]/;for(let i=t;i<=n;i++){const t=$(e[i]).text();if(c.test(t)){if(s){if(i<=o){l="";continue}break}{const e=t.match(r);if(e){if(i<=o){l="";continue}l+=e[0];break}}}l+=t}return l.replace(/(\r\n|\n|\r)/g," ").trim()}(i,d,g,p,c,l);return f=r(f,function(e){const t={en:{single:{open:["'","‘","‛"],close:["'","’","‚"]},double:{open:['"',"“","″"],close:['"',"”","″"]}},fr:{single:{open:["'","‘"],close:["'","’"]},double:{open:["«",'"'],close:["»",'"']}},de:{single:{open:["'","‘"],close:["'","’"]},double:{open:['"',"„","“"],close:['"',"”"]}},es:{single:{open:["'","‘"],close:["'","’"]},double:{open:["«",'"'],close:["»",'"']}},it:{single:{open:["'","‘"],close:["'","’"]},double:{open:["«",'"'],close:["»",'"']}},pt:{single:{open:["'","‘"],close:["'","’"]},double:{open:["«",'"'],close:["»",'"']}},zh:{single:{open:["'"],close:["'"]},double:{open:['"'],close:['"']}},ja:{single:{open:["'"],close:["'"]},double:{open:['"'],close:['"']}},ko:{single:{open:["'"],close:["'"]},double:{open:['"'],close:['"']}},ar:{single:{open:["‘"],close:["’"]},double:{open:["“"],close:["”"]}},he:{single:{open:["‘"],close:["’"]},double:{open:["“"],close:["”"]}},ru:{single:{open:["'","‘"],close:["'","’"]},double:{open:["«",'"'],close:["»",'"']}},pl:{single:{open:["'","‘"],close:["'","’"]},double:{open:["„",'"'],close:["”"]}},tr:{single:{open:["'","‘"],close:["'","’"]},double:{open:['"'],close:['"']}},el:{single:{open:["'","‘"],close:["'","’"]},double:{open:['"',"«"],close:['"',"»"]}},vi:{single:{open:["'","‘"],close:["'","’"]},double:{open:['"'],close:['"']}}};return t[e]||t.en}(u)),f=f.replace(/\s+/g," ").trim(),f}}})(),LinkBuilder={forWordInDictionary:(e,t)=>{const n=t.replace(/\s+/g," ").trim();return e.replace("%s",encodeURIComponent(n))},forTranslationInText:(e,t)=>{let n=SentenceExtractor.extractSentence(t,!0);return e.replace("%s",encodeURI(n))},forTranslationInVideo:(e,t)=>{let n=SentenceExtractor.extractSentence(t,!1);return e.replace("%s",encodeURIComponent(n))},forTranslationInStudy:(e,t)=>{const n=SentenceExtractor.extractSentence(t,!1)||t.parent("p").text().trim()||t.text();return e.replace("%s",encodeURIComponent(n))}};