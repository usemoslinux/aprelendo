$(document).ready((function(){$("#btn-save-reader-prefs").on("click",(async function(){const e=$("#mode").val()+"mode",a="lightmode sepiamode darkmode";let s=$(parent.document.body),o=$("#text-container");s.removeClass(a).addClass(e),o.css({"font-family":$("#fontfamily").val(),"font-size":$("#fontsize").val(),"text-align":$("#alignment").val(),"line-height":$("#lineheight").val()});const n=s.find(".offcanvas"),t=s.find("#close-offcanvas");n.length&&(n.removeClass(a).addClass(e),t.toggleClass("btn-close-white","darkmode"===e));const r=s.find("#audioplayer-container");r.length&&r.removeClass(a).addClass(e);try{const e=new URLSearchParams($("#prefs-modal-form").serialize()),a=await fetch("/ajax/savepreferences.php",{method:"POST",body:e});if(!a.ok)throw new Error(`HTTP error: ${a.status}`);const s=await a.json();if(!s.success)throw new Error(s.error_msg||"Failed to save reader preferences.")}catch(e){showMessage(e.message,"alert-danger")}}))}));