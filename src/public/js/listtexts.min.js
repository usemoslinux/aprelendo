$(document).ready((function(){function t(){const t=getCurrentFileName(),e=getCurrentURIParameters(),a={p:e.p?e.p:"1",ft:$(".ft.active").data("value")||0,fl:$(".fl.active").data("value")||0,s:$("#s").val().trim(),sa:$(".sa").hasClass("active")?"1":"0",o:$(".o.active").data("value")||0},i=buildQueryString(a);window.location.replace(t+i)}function e(){0===$("input[type=checkbox]:checked").length?$("#actions-menu").addClass("disabled"):$("#actions-menu").removeClass("disabled")}$("#search").trigger("focus"),$("input:checkbox").prop("checked",!1),$("#modal-achievements").length&&$("#modal-achievements").modal("show"),$("form").on("submit",(function(e){e.preventDefault(),t()})),$("#mDelete, .imDelete").on("click",(async function(){if(confirm("Really delete?")){let e=[];if("mDelete"===$(this).attr("id")?$("input.chkbox-selrow:checked").each((function(){e.push($(this).attr("data-idText"))})):$(this).hasClass("imDelete")&&e.push($(this).closest("tr").find("input").attr("data-idText")),0===e.length)return;const a="1"==getCurrentURIParameters().sa;try{const i=new URLSearchParams;i.append("textIDs",JSON.stringify(e)),i.append("is_archived",a?1:0);const s=await fetch("/ajax/removetext.php",{method:"POST",body:i});if(!s.ok)throw new Error(`HTTP error: ${s.status}`);const o=await s.json();if(!o.success)throw new Error(o.error_msg||"Failed to delete texts.");t()}catch(t){alert(`Oops! ${t.message}`)}}})),$("#mArchive, .imArchive").on("click",(async function(){const e="Archive"===$(this).text().trim();let a=[];if("mArchive"===$(this).attr("id")?$("input.chkbox-selrow:checked").each((function(){a.push($(this).attr("data-idText"))})):$(this).hasClass("imArchive")&&a.push($(this).closest("tr").find("input").attr("data-idText")),0!==a.length)try{const i=new URLSearchParams;i.append("textIDs",JSON.stringify(a)),i.append("archivetext",e);const s=await fetch("/ajax/archivetext.php",{method:"POST",body:i});if(!s.ok)throw new Error(`HTTP error: ${s.status}`);const o=await s.json();if(!o.success)throw new Error(o.error_msg||"Failed to archive texts.");t()}catch(t){alert(`Oops! ${t.message}`)}})),$(".imShare").on("click",(async function(){if(confirm("Sharing this text is irreversible. Once shared, it cannot be made private again. Are you sure you want to proceed?")){let e=$(this).closest("tr").find("input").attr("data-idText");if(void 0===e)return;try{const a=new URLSearchParams({textID:e}),i=await fetch("/ajax/sharetext.php",{method:"POST",body:a});if(!i.ok)throw new Error(`HTTP error: ${i.status}`);const s=await i.json();if(!s.success)throw new Error(s.error_msg||"Sharing text failed.");t()}catch(t){alert(`Oops! ${t.message}`)}}})),$(".imEdit").on("click",(function(){let t=$(this).closest("tr").find("input").attr("data-idText");void 0!==t&&(window.location.href="addtext?id="+encodeURIComponent(t))})),$(document).on("change",".chkbox-selrow",e),$(document).on("click","#chkbox-selall",(function(t){t.stopPropagation();$(".chkbox-selrow").prop("checked",$(this).prop("checked")),e()})),$("#btn-filter + div > a").on("click",(function(){const t=$(this);if(t.is(".sa"))t.toggleClass("active");else{t.addClass("active");let e="";t.is(".ft")?e=".ft":t.is(".fl")&&(e=".fl"),t.siblings(".active"+e).each((function(){$(this).toggleClass("active")}))}$("form").trigger("submit")})),$("#dropdown-menu-sort .o").on("click",(function(t){const e=getCurrentFileName(),a={ft:$(".ft.active").data("value")||0,fl:$(".fl.active").data("value")||0,s:$("#s").val().trim(),sa:$(".sa").hasClass("active")?"1":"0",o:$(this).data("value")||0},i=buildQueryString(a);window.location.replace(e+i)})),$(document).on("click","li.disabled",(function(){return!1})),$("#welcome-close").on("click",(function(t){t.preventDefault(),setCookie("hide_welcome_msg",!0,3650)}))}));