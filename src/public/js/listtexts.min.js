$(document).ready((function(){let t={s:new URLSearchParams(window.location.search).get("s")||"",o:new URLSearchParams(window.location.search).get("o")||0,ft:new URLSearchParams(window.location.search).get("ft")||0,fl:new URLSearchParams(window.location.search).get("fl")||0,sa:new URLSearchParams(window.location.search).get("sa")||0,p:new URLSearchParams(window.location.search).get("p")||1};async function e(){$("#texts-loader").removeClass("d-none"),$("#texts-content").addClass("opacity-50");try{const e=new URLSearchParams(t).toString(),o=await fetch(`/ajax/gettexts.php?${e}`);if(!o.ok)throw new Error(`HTTP error: ${o.status}`);const s=await o.json();if(!s.success)throw new Error(s.error_msg||"Failed to fetch texts");$("#texts-content").html(s.payload.html);const n=window.location.pathname+"?"+e;window.history.pushState(t,"",n),"undefined"!=typeof Tooltips&&Tooltips.init(),a()}catch(t){$("#texts-content").html(`<div class="alert alert-danger">Error: ${t.message}</div>`)}finally{$("#texts-loader").addClass("d-none"),$("#texts-content").removeClass("opacity-50")}}function a(){0===$("input.chkbox-selrow:checked").length?$("#actions-menu").addClass("disabled"):$("#actions-menu").removeClass("disabled")}e(),$("#search").trigger("focus"),$("#modal-achievements").length&&$("#modal-achievements").modal("show"),$("#texts-filter-form").on("submit",(function(a){a.preventDefault(),t.s=$("#s").val().trim(),t.p=1,e()})),$(document).on("click","#mDelete, .imDelete",(async function(){if(confirm("Really delete?")){let a=[];if("mDelete"===$(this).attr("id")?$("input.chkbox-selrow:checked").each((function(){a.push($(this).attr("data-idText"))})):$(this).hasClass("imDelete")&&a.push($(this).closest("tr").find("input").attr("data-idText")),0===a.length)return;try{const o=new URLSearchParams;o.append("textIDs",JSON.stringify(a)),o.append("is_archived","1"==t.sa?1:0);const s=await fetch("/ajax/removetext.php",{method:"POST",body:o});if(!s.ok)throw new Error(`HTTP error: ${s.status}`);const n=await s.json();if(!n.success)throw new Error(n.error_msg||"Failed to delete texts.");e()}catch(t){alert(`Oops! ${t.message}`)}}})),$(document).on("click","#mArchive, .imArchive",(async function(){const t="Archive"===$(this).text().trim();let a=[];if("mArchive"===$(this).attr("id")?$("input.chkbox-selrow:checked").each((function(){a.push($(this).attr("data-idText"))})):$(this).hasClass("imArchive")&&a.push($(this).closest("tr").find("input").attr("data-idText")),0!==a.length)try{const o=new URLSearchParams;o.append("textIDs",JSON.stringify(a)),o.append("archivetext",t);const s=await fetch("/ajax/archivetext.php",{method:"POST",body:o});if(!s.ok)throw new Error(`HTTP error: ${s.status}`);const n=await s.json();if(!n.success)throw new Error(n.error_msg||"Failed to archive texts.");e()}catch(t){alert(`Oops! ${t.message}`)}})),$(document).on("click",".imShare",(async function(){if(confirm("Sharing this text is irreversible. Are you sure?")){let t=$(this).closest("tr").find("input").attr("data-idText");if(void 0===t)return;try{const a=new URLSearchParams({textID:t}),o=await fetch("/ajax/sharetext.php",{method:"POST",body:a});if(!o.ok)throw new Error(`HTTP error: ${o.status}`);const s=await o.json();if(!s.success)throw new Error(s.error_msg||"Sharing text failed.");e()}catch(t){alert(`Oops! ${t.message}`)}}})),$(document).on("click",".imEdit",(function(){let t=$(this).closest("tr").find("input").attr("data-idText");void 0!==t&&(window.location.href="addtext?id="+encodeURIComponent(t))})),$(document).on("change",".chkbox-selrow",a),$(document).on("click","#chkbox-selall",(function(t){$(".chkbox-selrow").prop("checked",$(this).prop("checked")),a()})),$(document).on("click","#filter-dropdown .dropdown-item",(function(a){a.preventDefault();const o=$(this);if(o.is(".sa"))o.toggleClass("active"),t.sa=o.hasClass("active")?1:0;else{const e=o.is(".ft"),a=e?".ft":".fl";o.parent().find(a+".active").removeClass("active"),o.addClass("active"),e?t.ft=o.data("value")||0:t.fl=o.data("value")||0}t.p=1,e()})),$(document).on("click","#dropdown-menu-sort .o",(function(a){a.preventDefault(),t.o=$(this).data("value")||0,t.p=1,e()})),$(document).on("click",".pagination a",(function(a){a.preventDefault();const o=new URL($(this).attr("href"),window.location.origin);t.p=o.searchParams.get("p")||1,e()})),$(document).on("click","#welcome-close",(function(t){setCookie("hide_welcome_msg",!0,3650)})),window.onpopstate=function(a){a.state&&(t=a.state,$("#s").val(t.s),e())}}));