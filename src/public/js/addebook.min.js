$(document).ready((function(){function e(e){$("#upload-progress-bar").parent().addClass("d-none"),$("#btn-upload-epub").removeClass("disabled"),$("#btn-save").removeClass("disabled"),e&&($("#title").val(""),$("#author").val(""),$("#url").val(""))}function t(e){const t=ePub(),o=e.target.result;t.open(o),t.loaded.metadata.then((function(e){const t=document.getElementById("title"),o=document.getElementById("author");null!=t&&(t.value=e.title,o.value=e.creator)})),window.addEventListener("unload",(function(){t.destroy()}))}e(!0),$("#btn-upload-epub").on("click",(function(){$("#url").trigger("click")})),$("#url").on("change",(function(){$("#alert-box").addClass("d-none");const o=$(this);if("epub"!=o[0].files[0].name.split(".").pop().toLowerCase())showMessage("Invalid file extension. Only .epub files are allowed.","alert-danger"),e(!0);else if(window.FileReader){const e=new FileReader;e.onload=t,e.readAsArrayBuffer(o[0].files[0])}})),$("#form-addebook").on("submit",(function(t){t.preventDefault();const o=$("#upload-progress-bar"),a=new FormData(document.getElementById("form-addebook")),n=$("#audio-uri").text();$("#alert-box").addClass("d-none"),""==n||function(e){let t;try{t=new URL(e)}catch(e){return!1}return"http:"===t.protocol||"https:"===t.protocol}(n)?(o.parent().removeClass("d-none"),$("#btn-upload-epub").addClass("disabled"),$("#btn-save").addClass("disabled"),o.width("33%"),o.text("Uploading & converting ebook..."),$.ajax({type:"POST",url:"ajax/addtext.php",data:a,dataType:"json",contentType:!1,processData:!1}).done((function(t){null!=t.error_msg?(showMessage(t.error_msg,"alert-danger"),e(!1)):(o.width("100%"),o.text("Upload complete..."),o.parent().delay(1500).fadeOut("slow",(function(){window.location.replace("/texts")})))})).fail((function(t,o,a){showMessage("Oops! There was an unexpected error uploading this text.","alert-danger"),e(!1)}))):showMessage("Invalid audio URL.","alert-danger")})),$("#audio-uri").on("input",(function(){const e=$(this).val(),t=$("#audio-url-helptext");e.includes("drive.google.com")?t.html('<i class="bi bi-cloud-fill"></i> Remember to <a href="https://support.google.com/drive/answer/2494822?hl=en&co=GENIE.Platform%3DDesktop#zippy=%2Cshare-a-file-publicly" target="_blank" rel="noopener noreferrer" class="alert-link">share this file publicly</a>, allowing access to anyone with the link.'):t.text("Accepts URLs from YouTube, Google Drive, M3U playlists, RSS feeds, or any standard audio source.")}))}));