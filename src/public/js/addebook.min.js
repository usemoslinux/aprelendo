$(document).ready((function(){function e(e){$("#upload-progress-bar").parent().addClass("d-none"),$("#btn-upload-epub").removeClass("disabled"),$("#btn-save").removeClass("disabled"),e&&($("#title").val(""),$("#author").val(""),$("#url").val(""))}function t(e){const t=ePub(),a=e.target.result;t.open(a),t.loaded.metadata.then((function(e){const t=document.getElementById("title"),a=document.getElementById("author");null!=t&&(t.value=e.title,a.value=e.creator)})),window.addEventListener("unload",(function(){t.destroy()}))}e(!0),$("#btn-upload-epub").on("click",(function(){$("#url").trigger("click")})),$("#url").on("change",(function(){$("#alert-box").addClass("d-none");const a=$(this),n=a[0].files[0].name.split(".").pop().toLowerCase();if(a[0].files[0].size>2097152)showMessage("This file is bigger than the allowed limit (2 MB). Please try again.","alert-danger"),e(!0);else if("epub"!=n)showMessage("Invalid file extension. Only .epub files are allowed.","alert-danger"),e(!0);else if(window.FileReader){const e=new FileReader;e.onload=t,e.readAsArrayBuffer(a[0].files[0])}})),$("#form-addebook").on("submit",(function(t){t.preventDefault();const a=$("#upload-progress-bar"),n=new FormData(document.getElementById("form-addebook")),o=$("#audio-uri").text();$("#alert-box").addClass("d-none"),""==o||function(e){let t;try{t=new URL(e)}catch(e){return!1}return"http:"===t.protocol||"https:"===t.protocol}(o)?(a.parent().removeClass("d-none"),$("#btn-upload-epub").addClass("disabled"),$("#btn-save").addClass("disabled"),a.width("33%"),a.text("Uploading epub file..."),$.ajax({type:"POST",url:"ajax/addtext.php",data:n,dataType:"json",contentType:!1,processData:!1}).done((function(t){null!=t.error_msg?(showMessage(t.error_msg,"alert-danger"),e(!1)):(a.width("100%"),a.text("Upload complete..."),a.parent().delay(1500).fadeOut("slow",(function(){window.location.replace("/texts")})))})).fail((function(t,a,n){showMessage("Oops! There was an unexpected error uploading this text.","alert-danger"),e(!1)}))):showMessage("Invalid audio URL.","alert-danger")}))}));